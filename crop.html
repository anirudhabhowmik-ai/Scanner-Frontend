<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Primary Meta Tags -->
    <title>
      Crop PDF Online Free - Remove Margins & Trim PDF Pages | NextoPDF
    </title>
    <meta
      name="title"
      content="Crop PDF Online Free - Remove Margins & Trim PDF Pages | NextoPDF"
    />
    <meta
      name="description"
      content="Free online PDF cropping tool to remove white margins, trim pages, and adjust PDF boundaries. Crop single or multiple PDFs and merge them. No registration required, works in your browser."
    />
    <meta
      name="keywords"
      content="crop PDF online, trim PDF margins, remove PDF borders, crop PDF pages, PDF cropping tool, adjust PDF size, trim PDF online free, crop and merge PDF"
    />
    <meta name="author" content="NextoPDF" />
    <meta
      name="robots"
      content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"
    />

    <meta name="google-adsense-account" content="ca-pub-5797619165090350" />

    <!-- Canonical URL -->
    <link rel="canonical" href="https://nextopdf.com/crop" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://nextopdf.com/crop" />
    <meta
      property="og:title"
      content="Crop PDF Online Free - Remove Margins & Trim PDF Pages | NextoPDF"
    />
    <meta
      property="og:description"
      content="Free online PDF cropping tool to remove white margins and trim pages. Crop multiple PDFs and merge them into one document."
    />
    <meta
      property="og:image"
      content="https://nextopdf.com/images/crop-pdf-tool.png"
    />
    <meta property="og:site_name" content="NextoPDF" />
    <meta property="og:locale" content="en_US" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="https://nextopdf.com/crop" />
    <meta
      name="twitter:title"
      content="Crop PDF Online Free - Remove Margins & Trim PDF Pages"
    />
    <meta
      name="twitter:description"
      content="Free online PDF cropping tool to remove white margins and trim pages. No registration required."
    />
    <meta
      name="twitter:image"
      content="https://nextopdf.com/images/crop-pdf-tool.png"
    />

    <!-- Structured Data / Schema.org -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Crop PDF Online Tool",
        "url": "https://nextopdf.com/crop",
        "description": "Free online tool to crop PDF pages, remove margins, and merge multiple PDFs after cropping",
        "applicationCategory": "UtilitiesApplication",
        "operatingSystem": "Any",
        "browserRequirements": "Requires JavaScript. Modern browser with HTML5 support.",
        "offers": {
          "@type": "Offer",
          "price": "0",
          "priceCurrency": "USD"
        },
        "featureList": [
          "Crop PDF pages",
          "Remove white margins",
          "Adjust crop area with drag and drop",
          "Merge multiple cropped PDFs",
          "Apply crop to all pages",
          "No file size limits",
          "Secure browser-based processing"
        ],
        "author": {
          "@type": "Organization",
          "name": "NextoPDF"
        }
      }
    </script>

    <!-- Breadcrumb Schema -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
          {
            "@type": "ListItem",
            "position": 1,
            "name": "Home",
            "item": "https://nextopdf.com/"
          },
          {
            "@type": "ListItem",
            "position": 2,
            "name": "Crop PDF",
            "item": "https://nextopdf.com/crop"
          }
        ]
      }
    </script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&family=Inter:wght@400;500&display=swap"
      rel="stylesheet"
    />

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <!-- CSS -->
    <link rel="stylesheet" href="./css/style.css" />

    <!-- Favicon -->
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="./images/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="./images/favicon-16x16.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="./images/apple-touch-icon.png"
    />

    <style>
      .crop-box {
        position: absolute;
        border: 2px dashed #4f46e5;
        background: rgba(79, 70, 229, 0.15);
        cursor: move;
        touch-action: none;
      }

      .crop-handle {
        width: 14px;
        height: 14px;
        background: #4f46e5;
        position: absolute;
        right: -7px;
        bottom: -7px;
        border-radius: 3px;
        cursor: nwse-resize;
        touch-action: none;
      }

      .page-canvas-wrapper {
        position: relative;
        touch-action: none;
        display: inline-block;
      }

      .pages-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 30px;
        margin-top: 20px;
        max-width: 1200px;
        margin-left: auto;
        margin-right: auto;
      }

      @media (max-width: 768px) {
        .pages-grid {
          grid-template-columns: 1fr;
          gap: 20px;
        }
      }

      .page-card {
        position: relative;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        background: white;
      }

      .page-card canvas {
        width: 100%;
        height: auto;
        display: block;
      }

      .page-number {
        position: absolute;
        top: 5px;
        left: 5px;
        background: rgba(0, 0, 0, 0.7);
        color: #fff;
        padding: 4px 8px;
        font-size: 12px;
        border-radius: 4px;
        z-index: 10;
      }

      .pdf-source-tag {
        position: absolute;
        top: -22px;
        right: 5px;
        background: rgba(79, 70, 229, 0.9);
        color: #fff;
        padding: 4px 8px;
        font-size: 11px;
        border-radius: 4px;
        z-index: 10;
        max-width: 150px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .page-apply-btn {
        position: absolute;
        bottom: -10px;
        left: 50%;
        transform: translate(-50%, 10px);
        background: #4f46e5;
        color: #fff;
        border: none;
        padding: 6px 12px;
        font-size: 12px;
        border-radius: 6px;
        cursor: pointer;
        display: none;
        z-index: 20;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .page-apply-btn.show {
        display: block;
      }

      .page-apply-btn:hover {
        background: #4338ca;
      }

      .file-list {
        list-style: none;
        padding: 0;
        margin: 20px 0;
      }

      .file-list li {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px;
        margin: 8px 0;
        background: #f3f4f6;
        border-radius: 8px;
        border: 1px solid #e5e7eb;
      }

      .file-list .pdf-icon {
        color: #4f46e5;
        margin-right: 10px;
        font-size: 20px;
      }

      .file-list .delete-file {
        cursor: pointer;
        color: #ef4444;
        font-size: 18px;
        transition: color 0.2s;
      }

      .file-list .delete-file:hover {
        color: #dc2626;
      }

      .error-text {
        color: #ef4444;
        margin-top: 10px;
        padding: 10px;
        background: #fee2e2;
        border-radius: 6px;
        display: none;
      }

      .preview-section {
        margin-top: 30px;
      }

      .preview-section h4 {
        margin-bottom: 15px;
        color: #1f2937;
      }

      #cropArea {
        display: none;
        margin-top: 30px;
        text-align: center;
      }

      #cropArea.show {
        display: block;
      }

      .crop-instruction {
        margin: 15px 0;
        padding: 12px;
        background: #eff6ff;
        border-left: 4px solid #4f46e5;
        border-radius: 6px;
        text-align: left;
      }

      .crop-instruction strong {
        color: #4f46e5;
      }

      .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 9999;
      }

      .loading-overlay.show {
        display: flex;
      }

      .loading-content {
        background: white;
        padding: 30px;
        border-radius: 12px;
        text-align: center;
        max-width: 400px;
      }

      .loading-spinner {
        width: 50px;
        height: 50px;
        border: 4px solid #e5e7eb;
        border-top-color: #4f46e5;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .pdf-summary {
        margin: 15px 0;
        padding: 12px;
        background: #f0fdf4;
        border-left: 4px solid #10b981;
        border-radius: 6px;
      }

      .pdf-summary strong {
        color: #065f46;
      }

      .content-section {
        background: #f9fafb;
        padding: 60px 20px;
      }

      .content-section h2 {
        color: #1e3a8a;
        margin-bottom: 20px;
        font-size: 28px;
      }

      .content-section h3 {
        color: #1e3a8a;
        margin-bottom: 15px;
        margin-top: 35px;
        font-size: 22px;
      }

      .content-section p {
        color: #555;
        line-height: 1.8;
        margin-bottom: 20px;
      }

      .content-section ul {
        color: #555;
        line-height: 1.8;
        margin-bottom: 25px;
        padding-left: 25px;
      }

      .content-section li {
        margin-bottom: 10px;
      }

      .content-wrapper {
        max-width: 900px;
        margin: 0 auto;
        text-align: left;
      }

      .benefits-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 25px;
        margin-top: 30px;
      }

      .benefit-card {
        background: white;
        padding: 25px;
        border-radius: 8px;
        border: 1px solid #e5e7eb;
      }

      .benefit-card i {
        font-size: 36px;
        color: #4f46e5;
        margin-bottom: 15px;
      }

      .benefit-card h4 {
        color: #1f2937;
        margin-bottom: 10px;
        font-size: 18px;
      }

      .benefit-card p {
        color: #6b7280;
        font-size: 14px;
        line-height: 1.6;
      }

      .cropBtn-container {
        position: fixed;
        bottom: 0;
        background: #fff;
        border-top: 4px solid #1d0cff;
        width: 100%;
        padding: 20px 0;
        z-index: 999;
        box-shadow: 0 -6px 20px rgba(0, 0, 0, 0.15);
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }
    </style>

    <!-- Google AdSense (Replace with your AdSense ID) -->
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5797619165090350"
      crossorigin="anonymous"
    ></script>
  </head>

  <body>
    <!-- Skip to main content for accessibility -->
    <a
      href="#main-content"
      class="skip-to-content"
      style="position: absolute; left: -9999px; z-index: 999"
      >Skip to main content</a
    >

    <section id="header-placeholder"></section>

    <main id="main-content">
      <!-- Tool Section -->
      <section class="merge-tool">
        <div class="container">
          <h1>NextoPDF - Crop PDF Online Free - Remove Margins & Trim Pages</h1>
          <p>
            NextoPDF - Upload multiple PDFs, set custom crop areas for each
            page, and merge them into a single professionally cropped document.
            Remove unwanted white margins and borders instantly.
          </p>

          <div class="upload-section">
            <div id="uploadSection">
              <label for="pdfUpload" class="upload-label"
                ><i class="fa fa-upload" aria-hidden="true"></i> Choose PDF
                files</label
              >
              <input
                type="file"
                id="pdfUpload"
                accept=".pdf"
                multiple
                aria-label="Upload PDF files for cropping"
              />
            </div>

            <ul
              id="fileList"
              class="file-list"
              style="display: none"
              role="list"
            ></ul>

            <div
              id="pdfSummary"
              class="pdf-summary"
              style="display: none"
              role="status"
              aria-live="polite"
            >
              <strong
                ><i class="fas fa-info-circle" aria-hidden="true"></i>
                Summary:</strong
              >
              <div id="summaryText"></div>
            </div>

            <div id="cropArea" style="margin-bottom: 20px">
              <div class="crop-instruction" role="alert">
                <strong
                  ><i class="fas fa-info-circle" aria-hidden="true"></i> How to
                  crop:</strong
                >
                <ul style="margin: 8px 0 0 20px">
                  <li>
                    Drag the blue box to position the crop area on each page
                  </li>
                  <li>Use the handle at the bottom-right corner to resize</li>
                  <li>
                    Click "Apply to all pages" to use the same crop for all
                    pages
                  </li>
                  <li>All PDFs will be merged into one after cropping</li>
                </ul>
              </div>
              <div
                id="pagesGrid"
                class="pages-grid"
                role="region"
                aria-label="PDF pages preview"
              ></div>
            </div>

            <div class="cropBtn-container" id="cropBtn-container">
              <button
                id="cropBtn"
                class="cta-button"
                aria-label="Crop and merge PDF files"
              >
                <i
                  class="fa fa-spinner fa-spin"
                  style="display: none"
                  id="loaderIcon"
                  aria-hidden="true"
                ></i>
                <span class="btn-text"
                  ><i class="fas fa-crop" aria-hidden="true"></i
                ></span>
                Crop & Merge PDFs
              </button>

              <p
                class="error-text"
                id="errorMsg"
                role="alert"
                aria-live="assertive"
              ></p>
            </div>

            <p class="note" id="noteText">
              Supported format: PDF. You can upload multiple PDFs to crop and
              merge them. All processing happens securely in your browser.
            </p>

            <div id="resultBtns" style="display: none; margin-top: 30px">
              <div class="result-card">
                <i class="fa fa-file-pdf" aria-hidden="true"></i>
              </div>
              <p class="file-name">
                <a href="#" id="fileNameLink" download="cropped_merged.pdf"
                  >cropped_merged.pdf</a
                >
              </p>
              <div class="result-btns-container">
                <a
                  id="downloadBtn"
                  class="cta-button"
                  aria-label="Download cropped PDF"
                  ><i class="fa fa-download" aria-hidden="true"></i> Download
                  PDF</a
                >
                <a
                  id="shareBtn"
                  class="cta-button"
                  aria-label="Share cropped PDF"
                  ><i class="fa fa-share-alt" aria-hidden="true"></i> Share</a
                >
                <button
                  id="resetBtn"
                  class="secondary-btn"
                  aria-label="Start over with new PDF"
                >
                  <i class="fa fa-rotate-right" aria-hidden="true"></i> Crop
                  Another PDF
                </button>
              </div>
            </div>

            <div id="pdfPreview" class="preview-section" style="display: none">
              <h4>Preview Cropped & Merged PDF</h4>
              <div
                id="previewGrid"
                class="pages-grid"
                role="region"
                aria-label="Cropped PDF preview"
              ></div>
            </div>
          </div>
        </div>
      </section>

      <!-- The Story Behind This Tool (Real Reason I Built It) -->
      <section
        class="content-section"
        style="background: #f9fafb; padding: 60px 20px"
      >
        <div class="container">
          <div class="content-wrapper">
            <h2>Why I Built This PDF Cropping Tool</h2>

            <div
              style="
                background: white;
                padding: 30px;
                border-radius: 12px;
                margin-bottom: 30px;
              "
            >
              <p
                style="
                  color: #555;
                  line-height: 1.8;
                  font-size: 16px;
                  margin-bottom: 20px;
                "
              >
                A few years ago, I was putting together a portfolio for a job
                application. I had design samples, case studies, and project
                screenshots - all from different sources. Some had huge white
                borders around them. Others had random black edges from
                scanning. A few had watermarks in the margins from old software.
              </p>
              <p
                style="
                  color: #555;
                  line-height: 1.8;
                  font-size: 16px;
                  margin-bottom: 20px;
                "
              >
                I spent hours in photo editing software, cropping each image,
                saving them, and then rebuilding the PDF. It was miserable. I
                kept thinking "there has to be a better way."
              </p>
              <p style="color: #555; line-height: 1.8; font-size: 16px">
                That's why I built this. Now you can upload multiple PDFs, drag
                the crop box to keep only what you need, and download everything
                in one clean file. No more cropping screenshots one by one.
              </p>
            </div>

            <h3 style="color: #1e3a8a; margin-bottom: 15px; margin-top: 25px">
              Real People, Real Reasons (From Emails)
            </h3>

            <div style="display: grid; gap: 15px; margin-bottom: 30px">
              <div
                style="
                  background: white;
                  padding: 15px 20px;
                  border-radius: 8px;
                  border-left: 4px solid #4f46e5;
                "
              >
                <p style="color: #555; line-height: 1.8">
                  <strong>üìö The student:</strong> "I scanned textbook pages for
                  study guides, but the scanner added huge black borders.
                  Cropped them all at once instead of editing 50 images
                  individually." - College student
                </p>
              </div>
              <div
                style="
                  background: white;
                  padding: 15px 20px;
                  border-radius: 8px;
                  border-left: 4px solid #4f46e5;
                "
              >
                <p style="color: #555; line-height: 1.8">
                  <strong>üì∏ The photographer:</strong> "Client proofs had white
                  borders from my printing template. Cropped them out before
                  sending final galleries." - Photographer
                </p>
              </div>
              <div
                style="
                  background: white;
                  padding: 15px 20px;
                  border-radius: 8px;
                  border-left: 4px solid #4f46e5;
                "
              >
                <p style="color: #555; line-height: 1.8">
                  <strong>üìä The consultant:</strong> "Reports from different
                  clients had inconsistent margins. Cropped them all to match
                  before merging into one master document." - Business
                  consultant
                </p>
              </div>
              <div
                style="
                  background: white;
                  padding: 15px 20px;
                  border-radius: 8px;
                  border-left: 4px solid #4f46e5;
                "
              >
                <p style="color: #555; line-height: 1.8">
                  <strong>üñ®Ô∏è The printer:</strong> "Customer sent PDFs with crop
                  marks and registration marks. Removed them so the file would
                  print cleanly." - Print shop owner
                </p>
              </div>
              <div
                style="
                  background: white;
                  padding: 15px 20px;
                  border-radius: 8px;
                  border-left: 4px solid #4f46e5;
                "
              >
                <p style="color: #555; line-height: 1.8">
                  <strong>üì± The app developer:</strong> "Screenshots for my app
                  store listing had phone frames around them. Cropped to just
                  the app screens." - Developer
                </p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- How to Crop PDFs (Simple Steps) -->
      <section
        class="content-section"
        style="background: white; padding: 60px 20px"
      >
        <div class="container">
          <div class="content-wrapper">
            <h2>How to Crop PDF Pages (Three Simple Steps)</h2>

            <div class="benefits-grid" style="margin-bottom: 30px">
              <div
                class="benefit-card"
                style="background: #f9fafb; padding: 30px; border-radius: 12px"
              >
                <i
                  class="fas fa-upload"
                  style="font-size: 40px; color: #4f46e5; margin-bottom: 15px"
                ></i>
                <h4>1. Upload Your PDF(s)</h4>
                <p>
                  Upload one file or several. Each page shows up as a preview.
                  You can see exactly what you're working with - no guessing.
                </p>
              </div>
              <div
                class="benefit-card"
                style="background: #f9fafb; padding: 30px; border-radius: 12px"
              >
                <i
                  class="fas fa-crop-alt"
                  style="font-size: 40px; color: #4f46e5; margin-bottom: 15px"
                ></i>
                <h4>2. Drag the Blue Box</h4>
                <p>
                  Click and drag the blue crop box to keep the part you want.
                  Make it bigger or smaller by dragging the corners. Want the
                  same crop on every page? Click "Apply to all pages."
                </p>
              </div>
              <div
                class="benefit-card"
                style="background: #f9fafb; padding: 30px; border-radius: 12px"
              >
                <i
                  class="fas fa-download"
                  style="font-size: 40px; color: #4f46e5; margin-bottom: 15px"
                ></i>
                <h4>3. Download Your Cropped PDF</h4>
                <p>
                  Hit the crop button, wait a few seconds, and download. If you
                  uploaded multiple files, they'll be merged into one clean PDF
                  automatically.
                </p>
              </div>
            </div>

            <div
              style="
                background: #e8f0fe;
                padding: 20px;
                border-radius: 8px;
                text-align: center;
                margin-top: 20px;
              "
            >
              <p style="color: #1e3a8a; font-weight: 500">
                üëÄ Pro tip: The blue box shows what will stay. Everything
                outside it gets cut. Use the preview to make sure you're not
                cutting off something important.
              </p>
            </div>
          </div>
        </div>
      </section>

      <!-- Why You'd Need This (Real Talk) -->
      <section
        class="content-section"
        style="background: #f9fafb; padding: 60px 20px"
      >
        <div class="container">
          <div class="content-wrapper">
            <h2>Why You Might Need to Crop PDFs</h2>

            <div
              style="
                margin-bottom: 40px;
                background: white;
                padding: 25px;
                border-radius: 12px;
              "
            >
              <h3 style="color: #1e3a8a; margin-bottom: 15px">
                üìÑ Scanning Artifacts
              </h3>
              <p style="color: #555; line-height: 1.8">
                Scanners are great, but they often add junk: black borders,
                skewed edges, shadows from the scanner lid, or "Property of
                [Company]" stamps in the margin. Cropping cleans all that up.
                That student I mentioned? Their scanner added a thick black
                border to every page. One crop fixed the whole document.
              </p>
            </div>

            <div
              style="
                margin-bottom: 40px;
                background: white;
                padding: 25px;
                border-radius: 12px;
              "
            >
              <h3 style="color: #1e3a8a; margin-bottom: 15px">
                üìè Inconsistent Margins
              </h3>
              <p style="color: #555; line-height: 1.8">
                When you combine PDFs from different sources, margins are never
                the same. One document has 2-inch white space on the left,
                another has none. It looks sloppy. Cropping them all to the same
                size makes the final document look professional and cohesive.
              </p>
            </div>

            <div
              style="
                margin-bottom: 40px;
                background: white;
                padding: 25px;
                border-radius: 12px;
              "
            >
              <h3 style="color: #1e3a8a; margin-bottom: 15px">
                üì¶ Reducing File Size
              </h3>
              <p style="color: #555; line-height: 1.8">
                Every extra inch of white space adds to your file size. If you
                have a 50-page document with big margins, cropping can shrink
                the file noticeably. Smaller files are easier to email, upload,
                and share.
              </p>
            </div>

            <div
              style="
                margin-bottom: 40px;
                background: white;
                padding: 25px;
                border-radius: 12px;
              "
            >
              <h3 style="color: #1e3a8a; margin-bottom: 15px">
                üéØ Focusing on What Matters
              </h3>
              <p style="color: #555; line-height: 1.8">
                Sometimes you don't need the whole page. Maybe you only want the
                chart on page 5, the table on page 12, or the signature block.
                Crop out everything else and you've got exactly what you need,
                nothing you don't.
              </p>
            </div>

            <div
              style="
                margin-bottom: 40px;
                background: white;
                padding: 25px;
                border-radius: 12px;
              "
            >
              <h3 style="color: #1e3a8a; margin-bottom: 15px">
                üñ®Ô∏è Print Preparation
              </h3>
              <p style="color: #555; line-height: 1.8">
                Printers sometimes add crop marks, registration targets, or
                color bars around your document. If you're printing at home or
                sending to a client, you don't want those. Crop them out and
                your document prints clean.
              </p>
            </div>
          </div>
        </div>
      </section>

      <!-- Tips From Someone Who's Cropped Thousands of Pages -->
      <section
        class="content-section"
        style="background: white; padding: 60px 20px"
      >
        <div class="container">
          <div class="content-wrapper">
            <h2>Tips From Someone Who's Cropped Thousands of Pages</h2>

            <div
              style="
                margin-bottom: 35px;
                padding-left: 20px;
                border-left: 4px solid #4f46e5;
              "
            >
              <h3 style="color: #1e3a8a; margin-bottom: 10px">
                üìè Leave a Little Margin
              </h3>
              <p style="color: #555; line-height: 1.8">
                Don't crop right up to the text. Leave a tiny bit of breathing
                room around the edges. It looks more professional and prevents
                text from getting cut off if someone prints it.
              </p>
            </div>

            <div
              style="
                margin-bottom: 35px;
                padding-left: 20px;
                border-left: 4px solid #4f46e5;
              "
            >
              <h3 style="color: #1e3a8a; margin-bottom: 10px">
                üëÅÔ∏è Check Every Page
              </h3>
              <p style="color: #555; line-height: 1.8">
                If you use "Apply to all pages," scroll through and make sure it
                works everywhere. Page 5 might have a chart that extends further
                to the right than other pages. A quick check saves you from
                chopping off important content.
              </p>
            </div>

            <div
              style="
                margin-bottom: 35px;
                padding-left: 20px;
                border-left: 4px solid #4f46e5;
              "
            >
              <h3 style="color: #1e3a8a; margin-bottom: 10px">
                üíæ Keep the Original
              </h3>
              <p style="color: #555; line-height: 1.8">
                Always, always keep the original uncropped file somewhere. You
                might realize later that you cropped too aggressively or need
                the full page for something else. I've made this mistake and
                regretted it.
              </p>
            </div>

            <div
              style="
                margin-bottom: 35px;
                padding-left: 20px;
                border-left: 4px solid #4f46e5;
              "
            >
              <h3 style="color: #1e3a8a; margin-bottom: 10px">
                üîÑ Check Page Numbers and Headers
              </h3>
              <p style="color: #555; line-height: 1.8">
                Page numbers and headers often live near the edges. Make sure
                you're not accidentally cropping them out. If you are, adjust
                the crop box to include them - they're usually important.
              </p>
            </div>

            <div
              style="
                margin-bottom: 35px;
                padding-left: 20px;
                border-left: 4px solid #4f46e5;
              "
            >
              <h3 style="color: #1e3a8a; margin-bottom: 10px">
                üì± Test on Mobile
              </h3>
              <p style="color: #555; line-height: 1.8">
                If your cropped PDF will be viewed on phones, open it on one and
                check. Sometimes cropping too tight makes text hard to read on
                small screens. A little extra margin helps.
              </p>
            </div>
          </div>
        </div>
      </section>

      <!-- Common Problems (And Fixes) -->
      <section
        class="content-section"
        style="background: #f9fafb; padding: 60px 20px"
      >
        <div class="container">
          <div class="content-wrapper">
            <h2>Stuff That Goes Wrong (And How to Fix It)</h2>

            <div
              style="
                margin-bottom: 25px;
                background: white;
                padding: 20px;
                border-radius: 12px;
              "
            >
              <h3 style="color: #1e3a8a; margin-bottom: 10px">
                üìè "I cropped too much and cut off text"
              </h3>
              <p style="color: #555; line-height: 1.8">
                Happens to everyone. Just re-upload the original file (not the
                cropped one) and try again with a bigger crop box. That's why we
                keep saying to save the original.
              </p>
            </div>

            <div
              style="
                margin-bottom: 25px;
                background: white;
                padding: 20px;
                border-radius: 12px;
              "
            >
              <h3 style="color: #1e3a8a; margin-bottom: 10px">
                üîÑ "The crop looks wrong on some pages"
              </h3>
              <p style="color: #555; line-height: 1.8">
                If you used "Apply to all pages" and some pages are off, you'll
                need to crop those individually. Set the crop for the first
                page, apply to all, then go back and adjust the ones that need
                different treatment.
              </p>
            </div>

            <div
              style="
                margin-bottom: 25px;
                background: white;
                padding: 20px;
                border-radius: 12px;
              "
            >
              <h3 style="color: #1e3a8a; margin-bottom: 10px">
                üîí "It won't let me upload my PDF"
              </h3>
              <p style="color: #555; line-height: 1.8">
                Password protected? Use the Unlock PDF tool first. Encrypted
                files can't be edited until they're unlocked.
              </p>
            </div>

            <div
              style="
                margin-bottom: 25px;
                background: white;
                padding: 20px;
                border-radius: 12px;
              "
            >
              <h3 style="color: #1e3a8a; margin-bottom: 10px">
                üêå "The preview is loading slowly"
              </h3>
              <p style="color: #555; line-height: 1.8">
                Big PDFs take time to generate previews. A 100-page document
                might need a minute. If it's really stuck, try a smaller file or
                refresh and try again.
              </p>
            </div>

            <div
              style="
                margin-bottom: 25px;
                background: white;
                padding: 20px;
                border-radius: 12px;
              "
            >
              <h3 style="color: #1e3a8a; margin-bottom: 10px">
                üìâ "The quality dropped after cropping"
              </h3>
              <p style="color: #555; line-height: 1.8">
                It shouldn't. Cropping just removes areas - it doesn't
                recompress the rest. If quality seems worse, check if the
                original had issues. If it's a bug, email me.
              </p>
            </div>
          </div>
        </div>
      </section>

      <!-- FAQ - Real Questions -->
      <section
        class="content-section"
        style="background: white; padding: 60px 20px"
      >
        <div class="container">
          <div class="content-wrapper">
            <h2>Questions People Actually Ask</h2>

            <div
              style="
                margin-bottom: 30px;
                border-bottom: 1px solid #e5e7eb;
                padding-bottom: 20px;
              "
            >
              <h3 style="color: #1e3a8a; margin-bottom: 10px">
                "Can I crop different pages differently?"
              </h3>
              <p style="color: #555; line-height: 1.8">
                Yes. Set the crop for each page individually. If most pages are
                the same but a few are different, crop the similar ones first
                with "Apply to all," then adjust the outliers.
              </p>
            </div>

            <div
              style="
                margin-bottom: 30px;
                border-bottom: 1px solid #e5e7eb;
                padding-bottom: 20px;
              "
            >
              <h3 style="color: #1e3a8a; margin-bottom: 10px">
                "What's the difference between cropping and extracting?"
              </h3>
              <p style="color: #555; line-height: 1.8">
                Cropping removes parts of a page (like trimming margins).
                Extracting takes whole pages out. Think of cropping as scissors
                to cut down a page, extracting as pulling pages out of a stack.
              </p>
            </div>

            <div
              style="
                margin-bottom: 30px;
                border-bottom: 1px solid #e5e7eb;
                padding-bottom: 20px;
              "
            >
              <h3 style="color: #1e3a8a; margin-bottom: 10px">
                "Can I crop multiple PDFs at once?"
              </h3>
              <p style="color: #555; line-height: 1.8">
                Yes. Upload them all, set crops for each, and they'll be merged
                into one file at the end. Perfect for combining different
                sources into one clean document.
              </p>
            </div>

            <div
              style="
                margin-bottom: 30px;
                border-bottom: 1px solid #e5e7eb;
                padding-bottom: 20px;
              "
            >
              <h3 style="color: #1e3a8a; margin-bottom: 10px">
                "Do you keep my files?"
              </h3>
              <p style="color: #555; line-height: 1.8">
                No. Everything happens in your browser - files never leave your
                computer. I don't see them, don't store them, don't want them.
              </p>
            </div>

            <div
              style="
                margin-bottom: 30px;
                border-bottom: 1px solid #e5e7eb;
                padding-bottom: 20px;
              "
            >
              <h3 style="color: #1e3a8a; margin-bottom: 10px">
                "Is there a file size limit?"
              </h3>
              <p style="color: #555; line-height: 1.8">
                No hard limit, but really huge files might be slow on older
                computers. Your browser does all the work, so it depends on your
                device's memory.
              </p>
            </div>

            <div style="margin-bottom: 30px">
              <h3 style="color: #1e3a8a; margin-bottom: 10px">
                "Something's not working. Can you help?"
              </h3>
              <p style="color: #555; line-height: 1.8">
                Email me at <strong>nextopdf@gmail.com</strong>. Tell me what
                happened. I read everything and usually fix it within a day.
              </p>
            </div>
          </div>
        </div>
      </section>

      <!-- Related Tools -->
      <section class="benefits" style="background: #f9fafb; padding: 60px 20px">
        <div class="container">
          <h2>Other Tools You Might Need</h2>
          <p style="text-align: center; color: #555; margin-bottom: 40px">
            Same deal - all free, no sign-ups
          </p>
          <div class="feature-grid">
            <div class="feature-card">
              <i
                class="fas fa-cut"
                style="font-size: 40px; color: #4f46e5; margin-bottom: 15px"
              ></i>
              <h3>Split PDF</h3>
              <p>Break PDFs into smaller files after cropping.</p>
              <a
                href="/split"
                class="cta-button"
                style="font-size: 14px; padding: 8px 16px; margin-top: 10px"
                >Use Tool</a
              >
            </div>
            <div class="feature-card">
              <i
                class="fas fa-compress"
                style="font-size: 40px; color: #4f46e5; margin-bottom: 15px"
              ></i>
              <h3>Compress PDF</h3>
              <p>Make cropped PDFs even smaller for sharing.</p>
              <a
                href="/compress-pdf"
                class="cta-button"
                style="font-size: 14px; padding: 8px 16px; margin-top: 10px"
                >Use Tool</a
              >
            </div>
            <div class="feature-card">
              <i
                class="fas fa-sync-alt"
                style="font-size: 40px; color: #4f46e5; margin-bottom: 15px"
              ></i>
              <h3>Rotate PDF</h3>
              <p>Fix page orientation before or after cropping.</p>
              <a
                href="/rotate"
                class="cta-button"
                style="font-size: 14px; padding: 8px 16px; margin-top: 10px"
                >Use Tool</a
              >
            </div>
          </div>
        </div>
      </section>

      <!-- Simple Contact Reminder -->
      <section
        style="
          background: white;
          padding: 30px 20px;
          text-align: center;
          border-top: 1px solid #e5e7eb;
        "
      >
        <div class="container">
          <p style="font-size: 18px; color: #1e3a8a">
            Questions? Something not working?
            <a
              href="mailto:nextopdf@gmail.com"
              style="color: #4f46e5; font-weight: bold; text-decoration: none"
              >nextopdf@gmail.com</a
            >
          </p>
          <p style="color: #555; margin-top: 10px">
            I actually reply (usually within a day)
          </p>
        </div>
      </section>

      <!-- Fix the CTA Section (it said "Merge PDFs" incorrectly) -->
      <section
        class="hero"
        style="
          padding: 60px 20px;
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        "
      >
        <div class="container">
          <h2 style="font-size: 32px; margin-bottom: 15px; color: white">
            Ready to Clean Up Your PDFs?
          </h2>
          <p style="margin-bottom: 25px; color: white">
            Crop away the junk and keep only what matters. Free, fast, and your
            files stay private.
          </p>
          <a
            href="#main-content"
            class="cta-button"
            style="background: white; color: #667eea"
          >
            <i class="fas fa-arrow-up"></i> Start Cropping Now
          </a>
        </div>
      </section>
    </main>

    <!-- Footer -->
    <section id="footer-placeholder"></section>

    <div
      id="loadingOverlay"
      class="loading-overlay"
      role="alert"
      aria-live="assertive"
    >
      <div class="loading-content">
        <div class="loading-spinner" aria-hidden="true"></div>
        <h3 id="loadingTitle">Loading PDFs...</h3>
        <p id="loadingText">Please wait while we load your documents</p>
      </div>
    </div>

    <!-- JS -->
    <script src="./js/app.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

    <script>
      const BACKEND_URL = `${BACKEND_BASE_URL}/crop-pdf`;
      pdfjsLib.GlobalWorkerOptions.workerSrc =
        "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";

      const pdfUpload = document.getElementById("pdfUpload");
      const fileList = document.getElementById("fileList");
      const cropArea = document.getElementById("cropArea");
      const pagesGrid = document.getElementById("pagesGrid");
      const cropBtn = document.getElementById("cropBtn");
      const errorMsg = document.getElementById("errorMsg");
      const loaderIcon = document.getElementById("loaderIcon");
      const uploadSection = document.getElementById("uploadSection");
      const noteText = document.getElementById("noteText");
      const resultBtns = document.getElementById("resultBtns");
      const downloadBtn = document.getElementById("downloadBtn");
      const shareBtn = document.getElementById("shareBtn");
      const resetBtn = document.getElementById("resetBtn");
      const fileNameLink = document.getElementById("fileNameLink");
      const pdfPreview = document.getElementById("pdfPreview");
      const previewGrid = document.getElementById("previewGrid");
      const loadingOverlay = document.getElementById("loadingOverlay");
      const loadingTitle = document.getElementById("loadingTitle");
      const loadingText = document.getElementById("loadingText");
      const pdfSummary = document.getElementById("pdfSummary");
      const summaryText = document.getElementById("summaryText");

      let files = [];
      let allPages = []; // Store all pages from all PDFs with metadata

      function showError(msg) {
        errorMsg.textContent = msg;
        errorMsg.style.display = "block";
        setTimeout(() => {
          errorMsg.style.display = "none";
        }, 5000);
      }

      function showLoading(title, text) {
        loadingTitle.textContent = title;
        loadingText.textContent = text;
        loadingOverlay.classList.add("show");
      }

      function hideLoading() {
        loadingOverlay.classList.remove("show");
      }

      function renderFileList() {
        if (files.length === 0) {
          fileList.style.display = "none";
          fileList.innerHTML = "";
          pdfSummary.style.display = "none";
          return;
        }

        fileList.style.display = "block";
        fileList.innerHTML = "";

        files.forEach((file, index) => {
          const li = document.createElement("li");
          li.innerHTML = `
                    <div style="display: flex; align-items: center;">
                        <i class="fa fa-file-pdf pdf-icon" aria-hidden="true"></i>
                        <span>${file.name}</span>
                    </div>
                    <i class="fa fa-times delete-file" data-index="${index}" role="button" aria-label="Remove ${file.name}" tabindex="0"></i>
                `;
          fileList.appendChild(li);
        });
      }

      function updateSummary() {
        if (files.length === 0) {
          pdfSummary.style.display = "none";
          return;
        }

        const totalPages = allPages.length;
        pdfSummary.style.display = "block";
        summaryText.innerHTML = `${files.length} PDF(s) uploaded ‚Ä¢ ${totalPages} total pages ‚Ä¢ Will be merged into 1 PDF after cropping`;
      }

      fileList.addEventListener("click", async (e) => {
        if (e.target.classList.contains("delete-file")) {
          const index = parseInt(e.target.dataset.index);
          const fileName = files[index].name;

          // Remove file from array
          files.splice(index, 1);

          // Remove all pages from this file
          allPages = allPages.filter((page) => page.fileName !== fileName);

          renderFileList();
          updateSummary();

          // Reload all pages
          if (files.length > 0) {
            await loadAllPagesFromAllPDFs();
          } else {
            pagesGrid.innerHTML = "";
            cropArea.classList.remove("show");
            document.getElementById("cropBtn-container").style.display = "none";
          }
        }
      });

      pdfUpload.addEventListener("change", async () => {
        const newFiles = Array.from(pdfUpload.files);

        // Add new files (avoid duplicates)
        newFiles.forEach((file) => {
          if (
            !files.some((f) => f.name === file.name && f.size === file.size)
          ) {
            files.push(file);
          }
        });

        renderFileList();

        // Load all pages from all PDFs
        await loadAllPagesFromAllPDFs();
        document.getElementById("cropBtn-container").style.display = "flex";

        // Clear error when PDF is uploaded
        errorMsg.style.display = "none";

        // Reset input
        pdfUpload.value = "";
      });

      async function loadAllPagesFromAllPDFs() {
        if (files.length === 0) return;

        showLoading("Loading PDFs...", `Loading ${files.length} PDF file(s)`);

        try {
          allPages = [];
          pagesGrid.innerHTML = "";

          let globalPageIndex = 0;

          for (let fileIndex = 0; fileIndex < files.length; fileIndex++) {
            const file = files[fileIndex];

            loadingText.textContent = `Loading ${file.name} (${fileIndex + 1}/${files.length})`;

            const pdf = await pdfjsLib.getDocument(URL.createObjectURL(file))
              .promise;

            for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
              const page = await pdf.getPage(pageNum);
              const viewport = page.getViewport({ scale: 1 });
              const canvas = document.createElement("canvas");
              canvas.width = viewport.width;
              canvas.height = viewport.height;

              await page.render({
                canvasContext: canvas.getContext("2d"),
                viewport: viewport,
              }).promise;

              allPages.push({
                fileName: file.name,
                fileIndex: fileIndex,
                pageNum: pageNum,
                globalIndex: globalPageIndex,
                canvas: canvas,
                width: viewport.width,
                height: viewport.height,
              });

              globalPageIndex++;
            }
          }

          // Now render all pages in the grid
          renderAllPages();
          updateSummary();
          cropArea.classList.add("show");
        } catch (err) {
          showError("Failed to load PDFs: " + err.message);
        } finally {
          hideLoading();
        }
      }

      function renderAllPages() {
        pagesGrid.innerHTML = "";

        allPages.forEach((pageData, index) => {
          const card = document.createElement("div");
          card.className = "page-card";
          card.dataset.globalIndex = pageData.globalIndex;
          card.dataset.fileIndex = pageData.fileIndex;
          card.dataset.pageNum = pageData.pageNum;
          card.dataset.fileName = pageData.fileName;

          card.innerHTML = `
                    <div class="page-number">Page ${pageData.globalIndex + 1}</div>
                    <div class="pdf-source-tag" title="${pageData.fileName}">${pageData.fileName}</div>
                `;

          const wrapper = document.createElement("div");
          wrapper.className = "page-canvas-wrapper";

          // Create a new canvas and copy the image data
          const displayCanvas = document.createElement("canvas");
          displayCanvas.width = pageData.canvas.width;
          displayCanvas.height = pageData.canvas.height;
          displayCanvas.setAttribute("role", "img");
          displayCanvas.setAttribute(
            "aria-label",
            `Page ${pageData.globalIndex + 1} from ${pageData.fileName}`,
          );
          const ctx = displayCanvas.getContext("2d");
          ctx.drawImage(pageData.canvas, 0, 0);
          wrapper.appendChild(displayCanvas);

          const cropBox = document.createElement("div");
          cropBox.className = "crop-box";
          cropBox.setAttribute("role", "region");
          cropBox.setAttribute(
            "aria-label",
            "Crop area - drag to move, use corner handle to resize",
          );
          cropBox.style.width = "60%";
          cropBox.style.height = "60%";
          cropBox.style.left = "20%";
          cropBox.style.top = "20%";

          const handle = document.createElement("div");
          handle.className = "crop-handle";
          handle.setAttribute("role", "button");
          handle.setAttribute("aria-label", "Resize crop area");
          handle.setAttribute("tabindex", "0");
          cropBox.appendChild(handle);
          wrapper.appendChild(cropBox);

          card.appendChild(wrapper);

          // Add "Apply to all pages" button
          const applyBtn = document.createElement("button");
          applyBtn.className = "page-apply-btn";
          applyBtn.textContent = "Apply to all pages";
          applyBtn.setAttribute(
            "aria-label",
            "Apply this crop area to all pages",
          );
          applyBtn.onclick = () => applyToAllPages(card);
          card.appendChild(applyBtn);

          pagesGrid.appendChild(card);

          makeDraggable(cropBox, wrapper, card);
          makeResizable(cropBox, handle, wrapper, card);
        });
      }

      function showApplyButton(card) {
        const btn = card.querySelector(".page-apply-btn");
        if (btn) btn.classList.add("show");
      }

      function applyToAllPages(sourceCard) {
        const srcBox = sourceCard.querySelector(".crop-box");
        const srcWrapper = sourceCard.querySelector(".page-canvas-wrapper");

        const left = srcBox.offsetLeft / srcWrapper.clientWidth;
        const top = srcBox.offsetTop / srcWrapper.clientHeight;
        const width = srcBox.offsetWidth / srcWrapper.clientWidth;
        const height = srcBox.offsetHeight / srcWrapper.clientHeight;

        document.querySelectorAll(".page-card").forEach((card) => {
          if (card === sourceCard) return;
          const wrapper = card.querySelector(".page-canvas-wrapper");
          const box = card.querySelector(".crop-box");
          box.style.left = left * wrapper.clientWidth + "px";
          box.style.top = top * wrapper.clientHeight + "px";
          box.style.width = width * wrapper.clientWidth + "px";
          box.style.height = height * wrapper.clientHeight + "px";

          // Hide all other apply buttons
          const btn = card.querySelector(".page-apply-btn");
          if (btn) btn.classList.remove("show");
        });

        sourceCard.querySelector(".page-apply-btn").classList.remove("show");
      }

      function makeDraggable(box, wrapper, card) {
        box.addEventListener("pointerdown", (e) => {
          if (e.target.classList.contains("crop-handle")) return;
          e.preventDefault();
          box.setPointerCapture(e.pointerId);

          const startX = e.clientX;
          const startY = e.clientY;
          const startLeft = box.offsetLeft;
          const startTop = box.offsetTop;

          function move(ev) {
            let x = startLeft + (ev.clientX - startX);
            let y = startTop + (ev.clientY - startY);

            x = Math.max(0, Math.min(x, wrapper.offsetWidth - box.offsetWidth));
            y = Math.max(
              0,
              Math.min(y, wrapper.offsetHeight - box.offsetHeight),
            );

            box.style.left = x + "px";
            box.style.top = y + "px";
            showApplyButton(card);
          }

          function up(ev) {
            box.releasePointerCapture(ev.pointerId);
            box.removeEventListener("pointermove", move);
            box.removeEventListener("pointerup", up);
          }

          box.addEventListener("pointermove", move);
          box.addEventListener("pointerup", up);
        });
      }

      function makeResizable(box, handle, wrapper, card) {
        handle.addEventListener("pointerdown", (e) => {
          e.preventDefault();
          handle.setPointerCapture(e.pointerId);

          const startWidth = box.offsetWidth;
          const startHeight = box.offsetHeight;
          const startX = e.clientX;
          const startY = e.clientY;

          function move(ev) {
            let w = startWidth + (ev.clientX - startX);
            let h = startHeight + (ev.clientY - startY);

            w = Math.min(w, wrapper.offsetWidth - box.offsetLeft);
            h = Math.min(h, wrapper.offsetHeight - box.offsetTop);

            box.style.width = Math.max(40, w) + "px";
            box.style.height = Math.max(40, h) + "px";
            showApplyButton(card);
          }

          function up(ev) {
            handle.releasePointerCapture(ev.pointerId);
            handle.removeEventListener("pointermove", move);
            handle.removeEventListener("pointerup", up);
          }

          handle.addEventListener("pointermove", move);
          handle.addEventListener("pointerup", up);
        });
      }

      cropBtn.addEventListener("click", async () => {
        errorMsg.style.display = "none";

        if (files.length === 0) {
          showError("Please select at least one PDF file to crop.");
          return;
        }

        loaderIcon.style.display = "inline-block";
        cropBtn.querySelector(".btn-text").style.display = "none";
        cropBtn.disabled = true;

        try {
          // Group crop data by file
          const filesCropData = {};

          document.querySelectorAll(".page-card").forEach((card) => {
            const box = card.querySelector(".crop-box");
            const wrapper = card.querySelector(".page-canvas-wrapper");
            const canvas = card.querySelector("canvas");
            const fileIndex = parseInt(card.dataset.fileIndex);
            const pageNum = parseInt(card.dataset.pageNum);
            const fileName = card.dataset.fileName;

            const scaleX = canvas.width / wrapper.clientWidth;
            const scaleY = canvas.height / wrapper.clientHeight;

            if (!filesCropData[fileIndex]) {
              filesCropData[fileIndex] = {
                file: files[fileIndex],
                fileName: fileName,
                boxes: [],
              };
            }

            filesCropData[fileIndex].boxes.push({
              page: pageNum,
              x: box.offsetLeft * scaleX,
              y: box.offsetTop * scaleY,
              width: box.offsetWidth * scaleX,
              height: box.offsetHeight * scaleY,
            });
          });

          // Send all files to backend for cropping and merging
          const fd = new FormData();

          // Add all files
          Object.values(filesCropData).forEach((data, index) => {
            fd.append(`files`, data.file);
          });

          // Add crop data for all files
          const allCropData = Object.values(filesCropData).map((data) => ({
            fileName: data.fileName,
            boxes: data.boxes,
            mode: "individual",
          }));

          fd.append("cropData", JSON.stringify(allCropData));

          const res = await fetch(BACKEND_URL, {
            method: "POST",
            body: fd,
          });

          if (!res.ok) {
            const errorData = await res.json();
            throw new Error(errorData.error || "Server error");
          }

          const blob = await res.blob();
          const url = URL.createObjectURL(blob);

          // Update download links
          downloadBtn.href = url;
          shareBtn.href = url;
          fileNameLink.href = url;
          downloadBtn.setAttribute("download", "cropped_merged.pdf");
          fileNameLink.setAttribute("download", "cropped_merged.pdf");
          fileNameLink.textContent = "cropped_merged.pdf";

          // Show preview
          await showPreview(blob);

          // UI updates
          fileList.style.display = "none";
          uploadSection.style.display = "none";
          cropArea.classList.remove("show");
          noteText.style.display = "none";
          cropBtn.style.display = "none";
          resultBtns.style.display = "block";
          pdfSummary.style.display = "none";

          const isSmallDevice = window.matchMedia("(max-width: 768px)").matches;
          if (!isSmallDevice) {
            pdfPreview.style.display = "block";
          }

          fileNameLink.onclick = (e) => {
            e.preventDefault();
            isSmallDevice
              ? window.open(url, "_blank")
              : pdfPreview.scrollIntoView({ behavior: "smooth" });
          };
          document.getElementById("cropBtn-container").style.display = "none";
          window.scrollTo({ top: 0, behavior: "smooth" });
        } catch (err) {
          showError("Failed to crop PDFs: " + err.message);
        } finally {
          loaderIcon.style.display = "none";
          cropBtn.querySelector(".btn-text").style.display = "inline-block";
          cropBtn.disabled = false;
        }
      });

      async function showPreview(blob) {
        previewGrid.innerHTML = "";

        try {
          showLoading("Generating Preview...", "Loading all pages for preview");

          const pdf = await pdfjsLib.getDocument(URL.createObjectURL(blob))
            .promise;

          // Load ALL pages
          for (let i = 1; i <= pdf.numPages; i++) {
            loadingText.textContent = `Loading preview page ${i} of ${pdf.numPages}`;

            const page = await pdf.getPage(i);
            const viewport = page.getViewport({ scale: 1 });
            const canvas = document.createElement("canvas");
            canvas.width = viewport.width;
            canvas.height = viewport.height;
            canvas.setAttribute("role", "img");
            canvas.setAttribute("aria-label", `Preview of page ${i}`);

            await page.render({
              canvasContext: canvas.getContext("2d"),
              viewport: viewport,
            }).promise;

            const card = document.createElement("div");
            card.className = "page-card";
            card.innerHTML = `<div class="page-number">Page ${i}</div>`;
            card.appendChild(canvas);
            previewGrid.appendChild(card);
          }

          hideLoading();
        } catch (err) {
          hideLoading();
          showError("Failed to generate preview: " + err.message);
        }
      }

      resetBtn.addEventListener("click", () => {
        files = [];
        allPages = [];
        fileList.innerHTML = "";
        fileList.style.display = "none";
        pagesGrid.innerHTML = "";
        previewGrid.innerHTML = "";

        uploadSection.style.display = "block";
        cropBtn.style.display = "inline-flex";
        cropArea.classList.remove("show");
        noteText.style.display = "block";
        resultBtns.style.display = "none";
        pdfPreview.style.display = "none";
        errorMsg.style.display = "none";
        pdfSummary.style.display = "none";

        cropBtn.disabled = false;
        window.scrollTo({ top: 0, behavior: "smooth" });
      });
    </script>
  </body>
</html>
