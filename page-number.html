<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Add Page Numbers to PDF | PDFMaster</title>
    <meta name="description" content="Add page numbers to your PDF online. Fast, secure, and free.">
    <meta name="keywords" content="add page numbers, pdf editor online, page numbering">
    <meta name="author" content="PDFMaster">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&family=Inter:wght@400;500&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="./css/style.css">
    <link rel="icon" href="./favicon.ico" type="image/x-icon">

    <style>
        .btn-loading .btn-spinner {
            display: inline-block;
        }

        .btn-loading .btn-text {
            display: none;
        }

        .btn-spinner {
            display: none;
        }

        /* Options Grid Layout */
        .options-panel {
            display: none;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px auto;
            padding: 25px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            max-width: 900px;
        }

        .option-group {
            display: flex;
            flex-direction: column;
        }

        .option-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #1e3a8a;
            font-size: 14px;
        }

        .option-group label i {
            margin-right: 6px;
            color: #4f46e5;
        }

        .option-group select,
        .option-group input[type="number"],
        .option-group input[type="text"],
        .option-group input[type="color"] {
            padding: 10px 12px;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .option-group select:focus,
        .option-group input:focus {
            outline: none;
            border-color: #4f46e5;
        }

        .option-group input[type="color"] {
            height: 42px;
            width: 100%;
            cursor: pointer;
        }

        /* Format Toggles */
        .format-toggles {
            display: flex;
            gap: 8px;
        }

        .format-btn {
            flex: 1;
            padding: 10px;
            border: 2px solid #e5e7eb;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
        }

        .format-btn:hover {
            border-color: #4f46e5;
            background: #f0f1ff;
        }

        .format-btn.active {
            border-color: #4f46e5;
            background: #4f46e5;
            color: white;
        }

        /* Preview Grid */
        .pages-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
            margin: 30px auto;
            padding: 20px;
            background: white;
            border-radius: 12px;
            border: 2px dashed #e5e7eb;
            max-width: 900px;
            position: relative;
        }

        .pages-grid:empty::after {
            content: "Upload PDF files to see preview";
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #9ca3af;
            font-size: 14px;
        }

        .page-card {
            background: #f9fafb;
            border-radius: 10px;
            padding: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            position: relative;
        }

        .page-number {
            position: absolute;
            top: 8px;
            left: 8px;
            background: #4f46e5;
            color: white;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            z-index: 10;
        }

        .page-canvas-wrapper {
            height: 200px;
            background: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }

        .page-canvas-wrapper canvas {
            max-width: 100%;
            max-height: 100%;
            border-radius: 6px;
        }

        .page-number-preview {
            position: absolute;
            font-weight: 700;
            pointer-events: none;
            z-index: 5;
        }

        .result-btns-container {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        /* Tablet Responsive */
        @media (max-width: 768px) {
            .options-panel {
                grid-template-columns: 1fr;
            }

            .pages-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 15px;
                padding: 15px;
                max-width: 100%;
            }

            .page-canvas-wrapper {
                height: 180px;
            }
        }

        /* Mobile Responsive */
        @media (max-width: 480px) {
            .pages-grid {
                grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
                gap: 12px;
                padding: 12px;
            }

            .page-canvas-wrapper {
                height: 160px;
            }

            .page-number {
                font-size: 10px;
                padding: 3px 8px;
            }
        }

        /* Small Mobile */
        @media (max-width: 360px) {
            .pages-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
                padding: 10px;
            }

            .page-canvas-wrapper {
                height: 140px;
            }
        }
    </style>
</head>

<body>
    <section id="header-placeholder"></section>

    <section class="merge-tool">
        <div class="container">
            <h1>Add Page Numbers to PDF</h1>
            <p>Add customizable page numbers to your PDF files</p>

            <div class="upload-section">
                <div id="uploadSection">
                    <label for="pdfUpload" class="upload-label">
                        <i class="fa fa-upload"></i> Choose PDF files
                    </label>
                    <input type="file" id="pdfUpload" accept=".pdf" multiple>
                </div>

                <ul id="fileList" class="file-list" style="display:none;"></ul>

                <!-- OPTIONS PANEL -->
                <div id="optionsContainer" class="options-panel">
                    <div class="option-group">
                        <label for="position"><i class="fas fa-map-marker-alt"></i> Position</label>
                        <select id="position">
                            <option value="bottom-center">Bottom Center</option>
                            <option value="bottom-right">Bottom Right</option>
                            <option value="bottom-left">Bottom Left</option>
                            <option value="top-center">Top Center</option>
                            <option value="top-right">Top Right</option>
                            <option value="top-left">Top Left</option>
                        </select>
                    </div>

                    <div class="option-group">
                        <label for="fontFamily"><i class="fas fa-font"></i> Font Style</label>
                        <select id="fontFamily">
                            <option value="helvetica">Helvetica</option>
                            <option value="times">Times Roman</option>
                            <option value="courier">Courier</option>
                            <option value="symbol">Symbol</option>
                            <option value="zapfdingbats">Zapf Dingbats</option>
                        </select>
                    </div>

                    <div class="option-group">
                        <label for="fontSize"><i class="fas fa-text-height"></i> Font Size</label>
                        <input type="number" id="fontSize" value="12" min="8" max="48">
                    </div>

                    <div class="option-group">
                        <label for="fontColor"><i class="fas fa-palette"></i> Font Color</label>
                        <input type="color" id="fontColor" value="#000000">
                    </div>

                    <div class="option-group">
                        <label><i class="fas fa-bold"></i> Format</label>
                        <div class="format-toggles">
                            <button type="button" class="format-btn" id="boldBtn" title="Bold">
                                <i class="fas fa-bold"></i>
                            </button>
                            <button type="button" class="format-btn" id="italicBtn" title="Italic">
                                <i class="fas fa-italic"></i>
                            </button>
                            <button type="button" class="format-btn" id="underlineBtn" title="Underline">
                                <i class="fas fa-underline"></i>
                            </button>
                        </div>
                    </div>

                    <div class="option-group">
                        <label for="customText"><i class="fas fa-edit"></i> Custom Text</label>
                        <input type="text" id="customText" placeholder="e.g., Page {n} of {total}">
                    </div>

                    <div class="option-group">
                        <label for="startPage"><i class="fas fa-play"></i> Start Page</label>
                        <input type="number" id="startPage" value="1" min="1">
                    </div>

                    <div class="option-group">
                        <label for="endPage"><i class="fas fa-stop"></i> End Page</label>
                        <input type="number" id="endPage" value="" min="1" placeholder="Last page">
                    </div>

                    <div class="option-group">
                        <label for="startNumber"><i class="fas fa-hashtag"></i> Start Number</label>
                        <input type="number" id="startNumber" value="1" min="1">
                    </div>
                </div>

                <!-- PREVIEW -->
                <div id="pagesGrid" class="pages-grid" style="display:none;"></div>

                <button id="addNumbersBtn" class="cta-button" style="margin-top:15px;">
                    <span class="btn-spinner"><i class="fa fa-spinner fa-spin"></i></span>
                    <span class="btn-text"><i class="fa fa-list-ol"></i> Add Page Numbers</span>
                </button>

                <p id="errorMsg" class="error-text" style="display:none;"></p>

                <div id="resultBtns" style="display:none; margin-top:30px;">
                    <div class="result-card">
                        <i class="fa fa-file-pdf"></i>
                    </div>
                    <p class="file-name">
                        <a href="#" id="fileNameLink">page_numbered.pdf</a>
                    </p>
                    <div class="result-btns-container">
                        <a id="downloadBtn" class="cta-button">
                            <i class="fa fa-download"></i> Download PDF
                        </a>
                        <button id="resetBtn" class="secondary-btn">
                            <i class="fa fa-rotate-right"></i> Add Another PDF
                        </button>
                    </div>
                </div>

                <p id="noteText" class="note">
                    Supported format: PDF. You can upload multiple files at once.
                </p>
            </div>

            <div id="pdfPreview" style="display:none; margin-top:30px;">
                <h4>Preview PDF</h4>
                <iframe id="pdfFrame" width="100%" height="600"
                    style="border-radius:12px; border:1px solid #e5e7eb;"></iframe>
            </div>
        </div>
    </section>

    <section id="footer-placeholder"></section>

    <script src="./js/app.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

    <script>
        const BACKEND_URL = `${BACKEND_BASE_URL}/add-page-numbers`;

        pdfjsLib.GlobalWorkerOptions.workerSrc =
            "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";

        const pdfUpload = document.getElementById("pdfUpload");
        const fileList = document.getElementById("fileList");
        const addNumbersBtn = document.getElementById("addNumbersBtn");
        const errorMsg = document.getElementById("errorMsg");
        const resultBtns = document.getElementById("resultBtns");
        const downloadBtn = document.getElementById("downloadBtn");
        const resetBtn = document.getElementById("resetBtn");
        const pdfPreview = document.getElementById("pdfPreview");
        const pdfFrame = document.getElementById("pdfFrame");
        const uploadSection = document.getElementById("uploadSection");
        const pagesGrid = document.getElementById("pagesGrid");

        const optionsContainer = document.getElementById("optionsContainer");
        const position = document.getElementById("position");
        const fontFamily = document.getElementById("fontFamily");
        const fontSize = document.getElementById("fontSize");
        const fontColor = document.getElementById("fontColor");
        const boldBtn = document.getElementById("boldBtn");
        const italicBtn = document.getElementById("italicBtn");
        const underlineBtn = document.getElementById("underlineBtn");
        const customText = document.getElementById("customText");
        const startPage = document.getElementById("startPage");
        const endPage = document.getElementById("endPage");
        const startNumber = document.getElementById("startNumber");

        let files = [];
        let totalPages = 0;

        function clearError() {
            errorMsg.textContent = "";
            errorMsg.style.display = "none";
        }

        function showError(msg) {
            errorMsg.textContent = msg;
            errorMsg.style.display = "block";
        }

        // Format button toggles
        [boldBtn, italicBtn, underlineBtn].forEach(btn => {
            btn.addEventListener("click", () => {
                btn.classList.toggle("active");
                updateAllPreviews();
            });
        });

        // File upload handler
        pdfUpload.addEventListener("change", async () => {
            const newFiles = Array.from(pdfUpload.files);
            newFiles.forEach(file => {
                if (!files.some(f => f.name === file.name && f.size === file.size)) {
                    files.push(file);
                }
            });
            pdfUpload.value = "";
            renderFileList();
            await loadPDFs();
        });

        function renderFileList() {
            if (!files.length) {
                fileList.style.display = "none";
                return;
            }
            fileList.style.display = "block";
            fileList.innerHTML = "";
            files.forEach((f, i) => {
                const li = document.createElement("li");
                li.innerHTML = `
                    <span><i class="fa fa-file-pdf pdf-icon"></i> ${f.name}</span>
                    <i class="fa fa-times delete-file" data-i="${i}"></i>
                `;
                fileList.appendChild(li);
            });
        }

        fileList.addEventListener("click", async (e) => {
            if (!e.target.classList.contains("delete-file")) return;
            files.splice(e.target.dataset.i, 1);
            renderFileList();
            await loadPDFs();
        });

        async function loadPDFs() {
            clearError();
            pagesGrid.innerHTML = "";
            totalPages = 0;

            if (!files.length) {
                pagesGrid.style.display = "none";
                optionsContainer.style.display = "none";
                return;
            }

            pagesGrid.style.display = "grid";
            optionsContainer.style.display = "grid";

            let pageNo = 1;

            for (const file of files) {
                const pdf = await pdfjsLib.getDocument(URL.createObjectURL(file)).promise;
                totalPages += pdf.numPages;

                // Render ALL pages (removed the maxPages limit)
                for (let i = 1; i <= pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const viewport = page.getViewport({ scale: 0.5 });

                    const canvas = document.createElement("canvas");
                    canvas.width = viewport.width;
                    canvas.height = viewport.height;

                    await page.render({
                        canvasContext: canvas.getContext("2d"),
                        viewport: viewport
                    }).promise;

                    const card = document.createElement("div");
                    card.className = "page-card";
                    card.dataset.pageNum = pageNo;

                    card.innerHTML = `
                <div class="page-number">Page ${pageNo}</div>
                <div class="page-canvas-wrapper"></div>
            `;

                    const wrapper = card.querySelector(".page-canvas-wrapper");
                    wrapper.appendChild(canvas);

                    const preview = document.createElement("div");
                    preview.className = "page-number-preview";
                    updatePreviewText(preview, pageNo);
                    updatePreviewStyle(preview);
                    updatePreviewPosition(preview, wrapper);

                    wrapper.appendChild(preview);
                    pagesGrid.appendChild(card);
                    pageNo++;
                }
            }
        }

        function updatePreviewText(element, pageNum) {
            const startPageNum = parseInt(startPage.value) || 1;
            const endPageNum = parseInt(endPage.value) || totalPages;
            const startNumValue = parseInt(startNumber.value) || 1;

            // Check if this page should show a number
            if (pageNum < startPageNum || pageNum > endPageNum) {
                element.textContent = "";
                element.style.display = "none";
                return;
            }

            element.style.display = "block";

            // Calculate the display number
            const displayNum = startNumValue + (pageNum - startPageNum);

            let text = customText.value || "{n}";

            // Replace placeholders - handle both {n} and {1} style
            text = text.replace(/\{n\}/g, displayNum);
            text = text.replace(/\{1\}/g, displayNum);
            text = text.replace(/\{total\}/g, totalPages);

            element.textContent = text;
        }

        function updatePreviewStyle(element) {
            element.style.fontSize = fontSize.value + "px";
            element.style.color = fontColor.value;
            element.style.fontWeight = boldBtn.classList.contains("active") ? "bold" : "normal";
            element.style.fontStyle = italicBtn.classList.contains("active") ? "italic" : "normal";
            element.style.textDecoration = underlineBtn.classList.contains("active") ? "underline" : "none";

            const fonts = {
                helvetica: "Arial, sans-serif",
                times: "Times New Roman, serif",
                courier: "Courier New, monospace",
                symbol: "Symbol, serif",
                zapfdingbats: "Zapf Dingbats, serif"
            };
            element.style.fontFamily = fonts[fontFamily.value] || fonts.helvetica;
        }

        function updatePreviewPosition(element, wrapper) {
            const margin = 10;
            element.style.position = "absolute";
            element.style.top = "";
            element.style.bottom = "";
            element.style.left = "";
            element.style.right = "";
            element.style.transform = "";

            const pos = position.value;

            if (pos.startsWith("top")) {
                element.style.top = margin + "px";
            } else {
                element.style.bottom = margin + "px";
            }

            if (pos.includes("left")) {
                element.style.left = margin + "px";
            } else if (pos.includes("right")) {
                element.style.right = margin + "px";
            } else {
                element.style.left = "50%";
                element.style.transform = "translateX(-50%)";
            }
        }

        function updateAllPreviews() {
            const previews = document.querySelectorAll(".page-number-preview");
            previews.forEach((preview) => {
                const card = preview.closest(".page-card");
                const pageNum = card?.dataset.pageNum || 1;
                const wrapper = preview.parentElement;

                updatePreviewText(preview, pageNum);
                updatePreviewStyle(preview);
                updatePreviewPosition(preview, wrapper);
            });
        }

        [position, fontFamily, fontSize, fontColor, customText, startPage, endPage, startNumber].forEach(el => {
            el.addEventListener("change", updateAllPreviews);
            el.addEventListener("input", updateAllPreviews);
        });

        addNumbersBtn.addEventListener("click", async () => {
            clearError();
            if (!files.length) {
                showError("Please select at least one PDF file");
                return;
            }

            const fd = new FormData();
            files.forEach(f => fd.append("files", f));
            fd.append("options", JSON.stringify({
                position: position.value,
                fontFamily: fontFamily.value,
                fontSize: parseInt(fontSize.value),
                fontColor: fontColor.value,
                bold: boldBtn.classList.contains("active"),
                italic: italicBtn.classList.contains("active"),
                underline: underlineBtn.classList.contains("active"),
                customText: customText.value,
                startPage: parseInt(startPage.value),
                endPage: parseInt(endPage.value) || totalPages,
                startNumber: parseInt(startNumber.value)
            }));

            addNumbersBtn.disabled = true;
            addNumbersBtn.classList.add("btn-loading");

            try {
                const res = await fetch(BACKEND_URL, { method: "POST", body: fd });
                if (!res.ok) throw new Error(await res.text());

                const blob = await res.blob();
                const url = URL.createObjectURL(blob);

                downloadBtn.href = url;
                downloadBtn.download = "page_numbered.pdf";
                pdfFrame.src = url;

                resultBtns.style.display = "block";
                pdfPreview.style.display = "block";
                uploadSection.style.display = "none";
                addNumbersBtn.style.display = "none";
                fileList.style.display = "none";
                pagesGrid.style.display = "none";
                optionsContainer.style.display = "none";

            } catch (err) {
                showError(err.message);
            } finally {
                addNumbersBtn.disabled = false;
                addNumbersBtn.classList.remove("btn-loading");
            }
        });

        resetBtn.addEventListener("click", () => {
            files = [];
            totalPages = 0;
            pdfUpload.value = "";
            fileList.innerHTML = "";
            fileList.style.display = "none";
            pagesGrid.innerHTML = "";
            pagesGrid.style.display = "none";
            resultBtns.style.display = "none";
            pdfPreview.style.display = "none";
            uploadSection.style.display = "block";
            optionsContainer.style.display = "none";
            addNumbersBtn.style.display = "block";
            clearError();
        });
    </script>
</body>

</html>