<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Primary Meta Tags -->
    <title>
      Remove Watermark from PDF Online Free - Fast & Easy | NextoPDF
    </title>
    <meta
      name="title"
      content="Remove Watermark from PDF Online Free - Fast & Easy | NextoPDF"
    />
    <meta
      name="description"
      content="Remove watermarks from PDF files online for free. Click and select text or image watermarks to delete permanently. Uses PyMuPDF for accurate detection and removal."
    />
    <meta
      name="keywords"
      content="remove watermark from PDF, delete watermark PDF, PDF watermark remover free, remove text watermark, remove image watermark, clean PDF, unwatermark PDF"
    />
    <meta name="author" content="NextoPDF" />
    <meta
      name="robots"
      content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"
    />

    <!-- Canonical URL -->
    <link rel="canonical" href="https://nextopdf.com/remove-watermark" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://nextopdf.com/remove-watermark" />
    <meta
      property="og:title"
      content="Remove Watermark from PDF Online Free - Fast & Easy | NextoPDF"
    />
    <meta
      property="og:description"
      content="Remove watermarks from PDF files online for free. Click and select text or image watermarks to delete permanently."
    />
    <meta
      property="og:image"
      content="https://nextopdf.com/images/og-image.png"
    />
    <meta property="og:site_name" content="NextoPDF" />
    <meta property="og:locale" content="en_US" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="https://nextopdf.com/remove-watermark" />
    <meta
      name="twitter:title"
      content="Remove Watermark from PDF Online Free - Fast & Easy | NextoPDF"
    />
    <meta
      name="twitter:description"
      content="Remove watermarks from PDF files online for free. Click and select text or image watermarks to delete permanently."
    />
    <meta
      name="twitter:image"
      content="https://nextopdf.com/images/twitter-card.png"
    />
    <meta name="google-adsense-account" content="ca-pub-5797619165090350">

    <!-- Structured Data / Schema.org -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "NextoPDF - Remove Watermark from PDF",
        "url": "https://nextopdf.com/remove-watermark",
        "description": "Free online tool to remove text and image watermarks from PDF documents with accurate detection and permanent deletion",
        "applicationCategory": "UtilitiesApplication",
        "operatingSystem": "Any",
        "offers": {
          "@type": "Offer",
          "price": "0",
          "priceCurrency": "USD"
        },
        "featureList": "Remove text watermarks, Remove image watermarks, Batch processing, Visual selection, Permanent deletion, PyMuPDF powered"
      }
    </script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&family=Inter:wght@400;500&display=swap"
      rel="stylesheet"
    />

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <!-- Main CSS -->
    <link rel="stylesheet" href="./css/style.css" />

    <!-- Favicon -->
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="./images/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="./images/favicon-16x16.png"
    />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="./images/apple-touch-icon.png"
    />

    <!-- Google AdSense -->
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5797619165090350"
      crossorigin="anonymous"
    ></script>

    <style>
      .pages-grid {
        display: flex;
        flex-direction: column;
        gap: 30px;
        margin-top: 20px;
        align-items: center;
      }

      .page-card {
        position: relative;
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        padding: 20px;
        width: fit-content;
        max-width: 100%;
        transition: all 0.3s ease;
      }

      @media (max-width: 768px) {
        .page-card {
          padding: 15px;
        }
      }

      .page-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }

      .page-canvas-container {
        position: relative;
        display: inline-block;
        line-height: 0;
      }

      .page-card canvas {
        display: block;
        border-radius: 8px;
        border: 1px solid #e5e7eb;
        max-width: 100% !important;
        height: auto !important;
      }

      .page-number-badge {
        position: absolute;
        top: -8px;
        left: 8px;
        background: #4f46e5;
        color: white;
        padding: 6px 12px;
        border-radius: 12px;
        font-size: 13px;
        font-weight: 600;
        z-index: 5;
      }

      @media (max-width: 768px) {
        .page-number-badge {
          font-size: 12px;
          padding: 5px 10px;
        }
      }

      .watermark-overlay {
        position: absolute;
        cursor: pointer;
        user-select: none;
        z-index: 10;
        transition: all 0.2s ease;
        box-sizing: border-box;
        pointer-events: auto;
      }

      .watermark-overlay.type-text,
      .watermark-overlay.type-image {
        background: rgba(239, 68, 68, 0.15);
        outline: 2px solid rgba(239, 68, 68, 0.3);
        outline-offset: -2px;
      }

      .watermark-overlay.type-text:hover,
      .watermark-overlay.type-image:hover {
        outline-color: #ef4444 !important;
        background: rgba(239, 68, 68, 0.25) !important;
        z-index: 999;
      }

      .watermark-overlay.selected {
        outline-color: #ef4444 !important;
        background: rgba(239, 68, 68, 0.3) !important;
        outline-style: solid !important;
        outline-width: 3px !important;
        z-index: 9999;
      }

      .watermark-overlay.deleted {
        display: none;
      }

      .overlay-label {
        position: absolute;
        top: -22px;
        left: 0;
        background: #1e40af;
        color: white;
        padding: 9px 4px;
        font-size: 11px;
        border-radius: 4px;
        white-space: nowrap;
        display: none;
        z-index: 30;
        max-width: 250px;
        overflow: hidden;
        text-overflow: ellipsis;
        font-weight: 500;
      }

      @media (max-width: 768px) {
        .overlay-label {
          font-size: 10px;
          padding: 6px 6px;
          max-width: 200px;
          top: -14px;
        }
      }

      @media (max-width: 480px) {
        .overlay-label {
          font-size: 9px;
          padding: 5px 5px;
          max-width: 150px;
          top: -12px;
        }
      }

      .watermark-overlay:hover .overlay-label {
        display: block;
      }

      .delete-icon {
        position: absolute;
        top: -10px;
        right: -10px;
        background: #ef4444;
        color: white;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        display: none;
        align-items: center;
        justify-content: center;
        font-size: 11px;
        z-index: 20;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        cursor: pointer;
        flex-shrink: 0;
      }

      @media (max-width: 768px) {
        .delete-icon {
          width: 20px;
          height: 20px;
          font-size: 10px;
          top: -8px;
          right: -8px;
        }
      }

      @media (max-width: 480px) {
        .delete-icon {
          width: 18px;
          height: 18px;
          font-size: 9px;
          top: -6px;
          right: -6px;
        }
      }

      .delete-icon i {
        font-size: inherit;
      }

      .watermark-overlay.selected .delete-icon {
        display: flex;
      }

      .delete-icon:hover {
        background: #dc2626;
        transform: scale(1.1);
      }

      #controlPanel {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: white;
        border-top: 3px solid #ef4444;
        box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.15);
        z-index: 1000;
        padding: 15px;
        display: none;
        z-index: 999;
      }

      @media (max-width: 768px) {
        #controlPanel {
          padding: 12px 10px;
        }
      }

      #controlPanel.show {
        display: block;
      }

      .control-content {
        max-width: 1200px;
        margin: 0 auto;
        text-align: center;
      }

      .selection-info {
        font-size: 15px;
        color: #1e3a8a;
        margin-bottom: 12px;
        font-weight: 600;
      }

      @media (max-width: 768px) {
        .selection-info {
          font-size: 14px;
          margin-bottom: 10px;
        }
      }

      @media (max-width: 480px) {
        .selection-info {
          font-size: 13px;
        }
      }

      .action-buttons {
        display: flex;
        gap: 10px;
        justify-content: center;
        flex-wrap: wrap;
      }

      @media (max-width: 768px) {
        .action-buttons {
          gap: 8px;
        }
      }

      .action-buttons button {
        padding: 12px 24px;
        border-radius: 8px;
        font-weight: 600;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.2s;
        border: none;
      }

      @media (max-width: 768px) {
        .action-buttons button {
          padding: 10px 18px;
          font-size: 13px;
        }
      }

      @media (max-width: 480px) {
        .action-buttons button {
          padding: 10px 16px;
          font-size: 12px;
        }

        .action-buttons button i {
          font-size: 11px;
        }
      }

      .note-box {
        background: #f0f9ff;
        border-left: 4px solid #3b82f6;
        padding: 14px 18px;
        margin-top: 15px;
        font-size: 14px;
        border-radius: 4px;
        line-height: 1.6;
      }

      @media (max-width: 768px) {
        .note-box {
          font-size: 13px;
          padding: 12px 14px;
        }
      }

      @media (max-width: 480px) {
        .note-box {
          font-size: 12px;
          padding: 10px 12px;
        }
      }

      .success-message {
        background: #d1fae5;
        border-left: 4px solid #059669;
        padding: 14px 18px;
        margin-top: 15px;
        font-size: 14px;
        border-radius: 4px;
        color: #065f46;
        display: none;
        line-height: 1.6;
      }

      @media (max-width: 768px) {
        .success-message {
          font-size: 13px;
          padding: 12px 14px;
        }
      }

      @media (max-width: 480px) {
        .success-message {
          font-size: 12px;
          padding: 10px 12px;
        }
      }

      .success-message.show {
        display: block;
      }

      .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 9999;
      }

      .loading-overlay.show {
        display: flex;
      }

      .loading-content {
        background: white;
        padding: 30px;
        border-radius: 12px;
        text-align: center;
        max-width: 90%;
      }

      @media (max-width: 768px) {
        .loading-content {
          padding: 24px;
        }

        .loading-content p {
          font-size: 14px;
        }
      }

      @media (max-width: 480px) {
        .loading-content {
          padding: 20px;
        }

        .loading-content p {
          font-size: 13px;
        }
      }

      .spinner {
        border: 4px solid #f3f4f6;
        border-top: 4px solid #4f46e5;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        margin: 0 auto 15px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .file-list {
        display: none;
        list-style: none;
        padding: 0;
        margin: 20px 0;
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
      }

      .file-list li {
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 12px 16px;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 12px;
        transition: all 0.2s ease;
      }

      @media (max-width: 768px) {
        .file-list li {
          padding: 10px 12px;
          gap: 10px;
        }
      }

      .file-list li:hover {
        border-color: #4f46e5;
        transform: translateX(4px);
      }

      .pdf-icon {
        color: #ef4444;
        font-size: 20px;
      }

      @media (max-width: 768px) {
        .pdf-icon {
          font-size: 18px;
        }
      }

      .file-list li span {
        flex: 1;
        color: #1f2937;
        font-weight: 500;
        font-size: 14px;
        word-break: break-word;
      }

      @media (max-width: 768px) {
        .file-list li span {
          font-size: 13px;
        }
      }

      @media (max-width: 480px) {
        .file-list li span {
          font-size: 12px;
        }
      }

      .delete-file {
        background: #ef4444;
        border: none;
        color: white;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        transition: background 0.3s ease;
        flex-shrink: 0;
      }
      .delete-file i {
        color: #fff;
      }
      .delete-file:hover {
        background: #dc2626;
      }

      .merge-tool h1 {
        font-size: 2rem;
      }

      @media (max-width: 768px) {
        .merge-tool h1 {
          font-size: 1.5rem;
        }
      }

      @media (max-width: 480px) {
        .merge-tool h1 {
          font-size: 1.3rem;
        }
      }

      .merge-tool p {
        font-size: 1rem;
      }

      @media (max-width: 768px) {
        .merge-tool p {
          font-size: 0.9rem;
        }
      }

      @media (max-width: 480px) {
        .merge-tool p {
          font-size: 0.85rem;
        }
      }

      .error-text {
        background: #fee2e2;
        border-left: 4px solid #ef4444;
        padding: 12px 16px;
        font-size: 14px;
        border-radius: 4px;
        color: #991b1b;
        line-height: 1.6;
      }

      @media (max-width: 768px) {
        .error-text {
          font-size: 13px;
          padding: 10px 14px;
        }
      }

      @media (max-width: 480px) {
        .error-text {
          font-size: 12px;
          padding: 10px 12px;
        }
      }
    </style>
  </head>

  <body>
    <section id="header-placeholder"></section>

    <main role="main">
      <section class="merge-tool">
        <div class="container">
          <h1>Remove Watermark from PDF Online Free</h1>
          <p>
            Upload your PDF and click on any text or image to select watermarks
            for removal. Uses PyMuPDF for accurate detection and permanent
            deletion.
          </p>

          <div class="upload-section">
            <div id="uploadSection">
              <label class="upload-label" for="pdfUpload">
                <i class="fa fa-upload" aria-hidden="true"></i> Choose PDF file
              </label>
              <input
                type="file"
                id="pdfUpload"
                accept=".pdf"
                aria-label="Upload PDF file to remove watermarks"
              />
            </div>

            <ul id="fileList" class="file-list" role="list"></ul>

            <div
              class="success-message"
              id="successMsg"
              role="status"
              aria-live="polite"
            ></div>
            <div
              id="pagesGrid"
              class="pages-grid"
              style="display: none"
              role="region"
              aria-label="PDF pages with selectable watermarks"
            ></div>

            <div
              id="controlPanel"
              role="region"
              aria-label="Watermark removal controls"
            >
              <div class="control-content">
                <p
                  class="error-text"
                  id="errorMsg"
                  style="display: none; margin-bottom: 10px"
                  role="alert"
                  aria-live="assertive"
                ></p>
                <div
                  class="selection-info"
                  id="selectionInfo"
                  aria-live="polite"
                >
                  No items selected
                </div>
                <div class="action-buttons">
                  <button
                    id="clearBtn"
                    class="secondary-btn"
                    aria-label="Clear all selected watermarks"
                  >
                    <i class="fa fa-times" aria-hidden="true"></i> Clear
                    Selection
                  </button>
                  <button
                    id="deleteBtn"
                    class="cta-button"
                    style="background: #f59e0b"
                    aria-label="Delete selected watermarks"
                  >
                    <i class="fa fa-trash" aria-hidden="true"></i> Delete
                    Selected
                  </button>
                  <button
                    id="removeBtn"
                    class="cta-button"
                    aria-label="Save changes and download cleaned PDF"
                  >
                    <i class="fa fa-save" aria-hidden="true"></i> Save Changes
                  </button>
                </div>
              </div>
            </div>

            <div class="note-box" id="noteBox">
              ðŸ’¡ <strong>How it works:</strong> Click on text or images to
              select them (red border appears). Selected items can be deleted
              individually or in batch. Then click "Save Changes" to download
              your cleaned PDF.
            </div>

            <div id="resultBtns" style="display: none; margin-top: 30px">
              <div class="result-card">
                <i class="fa fa-file-pdf" aria-hidden="true"></i>
              </div>
              <p class="file-name">
                <a href="#" id="fileNameLink">cleaned.pdf</a>
              </p>
              <div class="result-btns-container">
                <a
                  id="downloadBtn"
                  href="#"
                  class="cta-button"
                  download
                  aria-label="Download cleaned PDF file"
                >
                  <i class="fa fa-download" aria-hidden="true"></i> Download
                </a>
                <a
                  id="shareBtn"
                  href="#"
                  class="cta-button"
                  aria-label="Share cleaned PDF file"
                >
                  <i class="fa fa-share-alt" aria-hidden="true"></i> Share
                </a>
                <button
                  id="resetBtn"
                  class="secondary-btn"
                  aria-label="Remove watermark from another PDF"
                >
                  <i class="fa fa-rotate-right" aria-hidden="true"></i> Remove
                  Another
                </button>
              </div>
            </div>
          </div>

          <div id="pdfPreview" style="display: none; margin-top: 30px">
            <h2>Preview Cleaned PDF</h2>
            <iframe
              id="pdfFrame"
              width="100%"
              height="600"
              title="Cleaned PDF preview"
              style="border-radius: 12px; border: 1px solid #e5e7eb"
            ></iframe>
          </div>
        </div>
      </section>

      <!-- How It Works Section -->
      <section class="benefits" style="background: white">
        <div class="container">
          <h2>How to Remove Watermark from PDF</h2>
          <div class="feature-grid">
            <div class="feature-card">
              <div
                style="
                  font-size: 48px;
                  color: #fbbf24;
                  font-weight: bold;
                  margin-bottom: 10px;
                "
                aria-hidden="true"
              >
                1
              </div>
              <h3>Upload Your PDF</h3>
              <p>
                Select your PDF file. Our PyMuPDF-powered detector automatically
                identifies all text and image watermarks on every page.
              </p>
            </div>
            <div class="feature-card">
              <div
                style="
                  font-size: 48px;
                  color: #fbbf24;
                  font-weight: bold;
                  margin-bottom: 10px;
                "
                aria-hidden="true"
              >
                2
              </div>
              <h3>Select Watermarks</h3>
              <p>
                Click on any watermark to select it (red border appears). Select
                multiple items or delete them individually with the X button.
              </p>
            </div>
            <div class="feature-card">
              <div
                style="
                  font-size: 48px;
                  color: #fbbf24;
                  font-weight: bold;
                  margin-bottom: 10px;
                "
                aria-hidden="true"
              >
                3
              </div>
              <h3>Download Clean PDF</h3>
              <p>
                Click "Save Changes" to permanently remove selected watermarks
                and download your cleaned PDF file instantly.
              </p>
            </div>
          </div>
        </div>
      </section>

      <!-- Why Remove Watermarks Section -->
      <section class="features" style="background: #f9fafb">
        <div class="container">
          <h2>Why Remove Watermarks from PDF Files?</h2>
          <div style="max-width: 900px; margin: 0 auto; text-align: left">
            <p style="color: #555; line-height: 1.8; margin-bottom: 30px">
              Watermarks serve various purposes, but there are many legitimate
              reasons to remove them from PDFs. Whether you own the document and
              want a clean version, need to replace outdated watermarks, or have
              permission to use unwatermarked content, our tool makes the
              process simple and efficient.
            </p>

            <h3 style="color: #1e3a8a; margin-bottom: 15px; margin-top: 35px">
              Legitimate Reasons to Remove Watermarks
            </h3>
            <p style="color: #555; line-height: 1.8; margin-bottom: 15px">
              There are many valid scenarios where watermark removal is
              necessary and appropriate:
            </p>
            <ul
              style="
                color: #555;
                line-height: 1.8;
                margin-bottom: 25px;
                padding-left: 25px;
              "
            >
              <li style="margin-bottom: 10px">
                <strong>Your Own Documents:</strong> You created the document
                and added watermarks for draft or review purposes, but now need
                a clean final version for distribution or archival.
              </li>
              <li style="margin-bottom: 10px">
                <strong>Outdated Watermarks:</strong> Company rebranding or
                policy changes make existing watermarks obsolete. Remove old
                watermarks to update documents with current branding.
              </li>
              <li style="margin-bottom: 10px">
                <strong>Draft to Final Conversion:</strong> Documents marked as
                "DRAFT" or "CONFIDENTIAL" need watermark removal when approved
                for final release or public distribution.
              </li>
              <li style="margin-bottom: 10px">
                <strong>Licensed Content:</strong> You've purchased or licensed
                content that includes sample watermarks, and you have permission
                to use the unwatermarked version.
              </li>
              <li style="margin-bottom: 10px">
                <strong>Document Cleanup:</strong> Scanned documents or PDFs
                from various sources may have accumulated unwanted watermarks
                that need removal for professional presentation.
              </li>
            </ul>

            <h3 style="color: #1e3a8a; margin-bottom: 15px; margin-top: 35px">
              Professional Document Cleanup
            </h3>
            <p style="color: #555; line-height: 1.8; margin-bottom: 25px">
              Organizations frequently need to remove watermarks from their own
              documents. Marketing materials may have "DRAFT" watermarks during
              review cycles that must be removed before final publication. Legal
              documents often carry "CONFIDENTIAL" markers during internal
              review but require clean versions for filing or public release.
              Training materials may include "INTERNAL USE ONLY" watermarks that
              need removal when content is approved for external distribution.
              Financial reports might have "PRELIMINARY" watermarks during
              preparation that must be deleted before submission to stakeholders
              or regulatory bodies. In all these cases, you're working with
              content you own or have full rights to modify.
            </p>

            <h3 style="color: #1e3a8a; margin-bottom: 15px; margin-top: 35px">
              Rebranding and Document Updates
            </h3>
            <p style="color: #555; line-height: 1.8; margin-bottom: 25px">
              Company acquisitions, mergers, or rebranding initiatives often
              create the need to update watermarks across entire document
              libraries. Rather than recreating documents from scratch, removing
              old watermarks and applying new ones saves significant time and
              resources. This is particularly important for technical
              documentation, training materials, and product catalogs where
              content accuracy matters more than watermark aesthetics.
              Organizations with thousands of documents can't realistically
              recreate everything, making watermark removal and replacement a
              practical necessity during brand transitions.
            </p>

            <h3 style="color: #1e3a8a; margin-bottom: 15px; margin-top: 35px">
              Archival and Historical Documents
            </h3>
            <p style="color: #555; line-height: 1.8; margin-bottom: 25px">
              Historical documents and archival materials often carry watermarks
              from previous digitization efforts, old scanning equipment, or
              outdated institutional branding. Museums, libraries, and research
              institutions frequently need to remove these watermarks to create
              clean versions for publication, academic research, or public
              access. The content itself may be in the public domain or owned by
              the institution, but watermarks from old scanning processes or
              defunct organizations need removal to present documents properly.
              This helps preserve historical accuracy and improves document
              usability for researchers and the public.
            </p>

            <h3 style="color: #1e3a8a; margin-bottom: 15px; margin-top: 35px">
              Sample to Purchased Content Transition
            </h3>
            <p style="color: #555; line-height: 1.8; margin-bottom: 25px">
              Many digital content providers offer watermarked samples or
              previews. After purchasing full access or licensing rights, buyers
              need to remove sample watermarks to use content professionally.
              This applies to stock templates, design resources, educational
              materials, and business documents. The watermark served its
              purpose during the preview phaseâ€”preventing unauthorized useâ€”but
              becomes unnecessary once you've paid for legitimate access.
              Content creators and sellers recognize this transition, which is
              why removal tools exist for properly licensed content.
            </p>

            <h3 style="color: #1e3a8a; margin-bottom: 15px; margin-top: 35px">
              Scan Artifact Removal
            </h3>
            <p style="color: #555; line-height: 1.8; margin-bottom: 25px">
              Document scanning processes sometimes introduce unintended
              watermark-like artifacts. Old copiers or scanners may add
              timestamps, device IDs, or institutional headers that appear as
              watermarks in PDFs. Government agencies, hospitals, and
              educational institutions often need to remove these scanning
              artifacts from their own documents to create clean, professional
              versions. These aren't deliberate copyright watermarks but rather
              technical byproducts of document digitization that reduce
              readability and professional appearance. Removing them improves
              document quality without affecting content ownership or copyright
              status.
            </p>

            <h3 style="color: #1e3a8a; margin-bottom: 15px; margin-top: 35px">
              Multi-Source Document Consolidation
            </h3>
            <p style="color: #555; line-height: 1.8; margin-bottom: 25px">
              When combining PDFs from multiple sources into unified
              documentsâ€”such as assembling reports, compiling research, or
              merging departmental contributionsâ€”inconsistent watermarks create
              visual chaos. Each source might have different watermarking
              schemes, fonts, or positions that clash when merged. Removing
              watermarks before consolidation creates cohesive, professional
              final documents. This is common in academic publishing, business
              reporting, and collaborative projects where multiple parties
              contribute content but need unified presentation.
            </p>

            <h3 style="color: #1e3a8a; margin-bottom: 15px; margin-top: 35px">
              Improving Document Accessibility
            </h3>
            <p style="color: #555; line-height: 1.8; margin-bottom: 25px">
              Watermarks can interfere with screen readers and accessibility
              tools used by people with visual impairments. Text watermarks may
              be read aloud by screen readers, creating confusion and disrupting
              document flow. Image watermarks can obscure important content or
              make text recognition difficult. For organizations committed to
              accessibility compliance (WCAG, ADA, Section 508), removing
              unnecessary watermarks from public-facing documents improves
              usability for all readers. This is especially important for
              government documents, educational materials, and consumer
              information that must be universally accessible.
            </p>
          </div>
        </div>
      </section>

      <!-- Features Section -->
      <section class="benefits" style="padding-top: 60px">
        <div class="container">
          <h2>Powerful Watermark Removal Features</h2>
          <div class="feature-grid">
            <div class="feature-card">
              <i
                class="fas fa-magic"
                style="font-size: 40px; color: #10b981; margin-bottom: 15px"
                aria-hidden="true"
              ></i>
              <h3>Automatic Detection</h3>
              <p>
                PyMuPDF-powered technology automatically detects all text and
                image watermarks on every page with high accuracy.
              </p>
            </div>
            <div class="feature-card">
              <i
                class="fas fa-mouse-pointer"
                style="font-size: 40px; color: #10b981; margin-bottom: 15px"
                aria-hidden="true"
              ></i>
              <h3>Click to Select</h3>
              <p>
                Simple click interface to select watermarks. Red borders
                highlight selections. Delete individually or in batches.
              </p>
            </div>
            <div class="feature-card">
              <i
                class="fas fa-eye"
                style="font-size: 40px; color: #10b981; margin-bottom: 15px"
                aria-hidden="true"
              ></i>
              <h3>Visual Preview</h3>
              <p>
                See exactly what will be removed before downloading. Live
                preview shows your PDF with watermarks highlighted.
              </p>
            </div>
            <div class="feature-card">
              <i
                class="fas fa-trash-alt"
                style="font-size: 40px; color: #10b981; margin-bottom: 15px"
                aria-hidden="true"
              ></i>
              <h3>Permanent Deletion</h3>
              <p>
                Watermarks are permanently removed from the PDF structure, not
                just visually hidden. Clean, professional results.
              </p>
            </div>
            <div class="feature-card">
              <i
                class="fas fa-layer-group"
                style="font-size: 40px; color: #10b981; margin-bottom: 15px"
                aria-hidden="true"
              ></i>
              <h3>Batch Selection</h3>
              <p>
                Select multiple watermarks across multiple pages and delete them
                all at once. Saves time on multi-page documents.
              </p>
            </div>
            <div class="feature-card">
              <i
                class="fas fa-undo"
                style="font-size: 40px; color: #10b981; margin-bottom: 15px"
                aria-hidden="true"
              ></i>
              <h3>Clear & Reset</h3>
              <p>
                Clear selections if you change your mind. Original file is never
                modifiedâ€”only the downloaded version reflects changes.
              </p>
            </div>
          </div>
        </div>
      </section>

      <!-- Tips Section -->
      <section class="features" style="background: white">
        <div class="container">
          <h2>Watermark Removal Tips and Best Practices</h2>
          <div style="max-width: 900px; margin: 0 auto; text-align: left">
            <div style="margin-bottom: 40px">
              <h3 style="color: #1e3a8a; margin-bottom: 15px">
                Understanding Detection Accuracy
              </h3>
              <p style="color: #555; line-height: 1.8; margin-bottom: 15px">
                Our PyMuPDF-based detection engine is highly accurate but works
                best under certain conditions:
              </p>
              <ul
                style="
                  color: #555;
                  line-height: 1.8;
                  margin-bottom: 20px;
                  padding-left: 25px;
                "
              >
                <li style="margin-bottom: 10px">
                  <strong>Text Watermarks:</strong> Standard text watermarks
                  added via PDF editing tools are detected with near-perfect
                  accuracy. The system identifies text objects based on PDF
                  structure.
                </li>
                <li style="margin-bottom: 10px">
                  <strong>Image Watermarks:</strong> Logo watermarks and graphic
                  overlays are detected as image objects. Detection works
                  regardless of transparency or positioning.
                </li>
                <li style="margin-bottom: 10px">
                  <strong>Layered PDFs:</strong> Watermarks on separate layers
                  are identified correctly. The tool distinguishes watermark
                  layers from content layers.
                </li>
                <li style="margin-bottom: 10px">
                  <strong>Embedded Watermarks:</strong> Some watermarks are
                  embedded in page backgrounds during PDF creation. These may
                  require manual selection if not automatically detected.
                </li>
              </ul>
            </div>

            <div style="margin-bottom: 40px">
              <h3 style="color: #1e3a8a; margin-bottom: 15px">
                Selection Strategy for Best Results
              </h3>
              <p style="color: #555; line-height: 1.8; margin-bottom: 15px">
                Strategic selection ensures you remove the right elements:
              </p>
              <p style="color: #555; line-height: 1.8; margin-bottom: 10px">
                <strong>Preview First:</strong> Always review detected
                watermarks before deletion. Hover over each highlighted area to
                see what content will be removed. Text watermarks show a preview
                of the text content.
              </p>
              <p style="color: #555; line-height: 1.8; margin-bottom: 10px">
                <strong>Test on Single Page:</strong> If unsure, try removing
                watermarks from one page first. Download and check the result
                before processing the entire document.
              </p>
              <p style="color: #555; line-height: 1.8; margin-bottom: 10px">
                <strong>Batch Carefully:</strong> When selecting multiple
                watermarks, ensure they're all intended for removal. Use the
                "Clear Selection" button if you accidentally select content you
                want to keep.
              </p>
              <p style="color: #555; line-height: 1.8; margin-bottom: 20px">
                <strong>Individual vs Batch:</strong> The X button on each
                watermark allows immediate deletion of single items. Use "Delete
                Selected" for batch removal of multiple watermarks at once.
              </p>
            </div>

            <div style="margin-bottom: 40px">
              <h3 style="color: #1e3a8a; margin-bottom: 15px">
                Handling Complex Watermarks
              </h3>
              <p style="color: #555; line-height: 1.8; margin-bottom: 15px">
                Some watermarks are more challenging to remove than others:
              </p>
              <p style="color: #555; line-height: 1.8; margin-bottom: 10px">
                <strong>Multi-Component Watermarks:</strong> Watermarks
                consisting of both text and images may be detected as separate
                elements. Select and delete each component individually or
                select all components before batch deletion.
              </p>
              <p style="color: #555; line-height: 1.8; margin-bottom: 10px">
                <strong>Repeated Watermarks:</strong> Documents with the same
                watermark on every page benefit from batch selection. Select all
                instances across pages and delete in one operation.
              </p>
              <p style="color: #555; line-height: 1.8; margin-bottom: 10px">
                <strong>Overlapping Content:</strong> If watermarks overlap
                important document content, removal will affect the underlying
                content as well. Check preview carefully before deletion.
              </p>
              <p style="color: #555; line-height: 1.8; margin-bottom: 20px">
                <strong>Background Watermarks:</strong> Watermarks merged into
                page backgrounds during scanning may not be detected as separate
                objects. These may require alternative approaches like image
                editing before PDF conversion.
              </p>
            </div>

            <div style="margin-bottom: 40px">
              <h3 style="color: #1e3a8a; margin-bottom: 15px">
                Quality Preservation Tips
              </h3>
              <p style="color: #555; line-height: 1.8; margin-bottom: 15px">
                Maintain document quality after watermark removal:
              </p>
              <ul
                style="
                  color: #555;
                  line-height: 1.8;
                  margin-bottom: 20px;
                  padding-left: 25px;
                "
              >
                <li style="margin-bottom: 10px">
                  Keep a backup of your original file before making changes.
                  While our tool doesn't modify originals, having a backup
                  ensures you can always start over.
                </li>
                <li style="margin-bottom: 10px">
                  Compare the cleaned PDF to the original to verify all intended
                  watermarks were removed and no unintended content was deleted.
                </li>
                <li style="margin-bottom: 10px">
                  Check file size after removal. Significant size reduction
                  indicates successful removal of image-based watermarks.
                </li>
                <li style="margin-bottom: 10px">
                  Test the cleaned PDF in multiple viewers (Adobe Acrobat,
                  browser PDF viewers, mobile apps) to ensure consistent
                  results.
                </li>
                <li style="margin-bottom: 10px">
                  If the PDF will be printed, print a test page to verify
                  watermark removal is complete and doesn't affect print
                  quality.
                </li>
              </ul>
            </div>

            <div style="margin-bottom: 40px">
              <h3 style="color: #1e3a8a; margin-bottom: 15px">
                When to Use Alternative Methods
              </h3>
              <p style="color: #555; line-height: 1.8; margin-bottom: 15px">
                Some situations may require different approaches:
              </p>
              <p style="color: #555; line-height: 1.8; margin-bottom: 10px">
                <strong>Scanned Documents:</strong> PDFs created from scanned
                paper documents may have watermarks as part of the image itself
                rather than as separate PDF objects. These require OCR and image
                editing rather than object-based removal.
              </p>
              <p style="color: #555; line-height: 1.8; margin-bottom: 10px">
                <strong>Encrypted PDFs:</strong> Password-protected or encrypted
                PDFs must be unlocked before watermark removal can proceed.
                Remove security first, then process watermarks.
              </p>
              <p style="color: #555; line-height: 1.8; margin-bottom: 10px">
                <strong>Form Fields:</strong> Interactive PDF forms with
                watermarks in form fields may require disabling the fields or
                converting to static PDF before watermark removal.
              </p>
              <p style="color: #555; line-height: 1.8; margin-bottom: 20px">
                <strong>Artistic Watermarks:</strong> Highly stylized or
                artistic watermarks that are integral to page design may need
                professional PDF editing tools for precise removal without
                affecting surrounding content.
              </p>
            </div>

            <div style="margin-bottom: 40px">
              <h3 style="color: #1e3a8a; margin-bottom: 15px">
                Workflow Integration
              </h3>
              <p style="color: #555; line-height: 1.8; margin-bottom: 15px">
                Incorporate watermark removal into document workflows:
              </p>
              <p style="color: #555; line-height: 1.8; margin-bottom: 10px">
                <strong>Draft to Final Process:</strong> Make watermark removal
                the final step before document publication. This ensures all
                edits are complete before removing draft markers.
              </p>
              <p style="color: #555; line-height: 1.8; margin-bottom: 10px">
                <strong>Batch Processing:</strong> For large document sets,
                establish a systematic approach: sort documents by watermark
                type, process similar watermarks together, verify results in
                batches.
              </p>
              <p style="color: #555; line-height: 1.8; margin-bottom: 10px">
                <strong>Version Control:</strong> Maintain clear naming
                conventions for watermarked vs. cleaned versions. Consider using
                suffixes like "_watermarked" and "_clean" in filenames.
              </p>
              <p style="color: #555; line-height: 1.8; margin-bottom: 20px">
                <strong>Archive Strategy:</strong> Decide whether to keep
                watermarked versions for audit trails or completely replace them
                with cleaned versions. Document your decision for compliance
                purposes.
              </p>
            </div>
          </div>
        </div>
      </section>

      <!-- FAQ Section -->
      <section class="features" style="background: #f9fafb">
        <div class="container">
          <h2>Frequently Asked Questions About PDF Watermark Removal</h2>
          <div style="max-width: 800px; margin: 0 auto; text-align: left">
            <div style="margin-bottom: 30px">
              <h3 style="color: #1e3a8a; margin-bottom: 10px">
                Is it legal to remove watermarks from PDFs?
              </h3>
              <p style="color: #555; line-height: 1.8">
                Yes, when you own the document or have permission to modify it.
                It's legal to remove watermarks from your own documents, drafts
                you've created, licensed content you've purchased, or any PDF
                where you have explicit permission. However, removing watermarks
                to use copyrighted material without permission is illegal.
                Always respect intellectual property rights and only remove
                watermarks from documents you own or are authorized to modify.
              </p>
            </div>

            <div style="margin-bottom: 30px">
              <h3 style="color: #1e3a8a; margin-bottom: 10px">
                What types of watermarks can be removed?
              </h3>
              <p style="color: #555; line-height: 1.8">
                Our tool removes text watermarks (copyright notices, DRAFT
                markers, company names) and image watermarks (logos, signatures,
                graphics) that are added as PDF objects. Watermarks embedded in
                the page background during PDF creation or scanning may not be
                detected as separate objects and could require different removal
                methods.
              </p>
            </div>

            <div style="margin-bottom: 30px">
              <h3 style="color: #1e3a8a; margin-bottom: 10px">
                How does watermark detection work?
              </h3>
              <p style="color: #555; line-height: 1.8">
                We use PyMuPDF, a professional PDF processing library, to
                analyze PDF structure and identify text and image objects that
                function as watermarks. The system examines object properties,
                positioning, transparency, and layer structure to distinguish
                watermarks from regular content. Detection accuracy depends on
                how watermarks were added to the PDF.
              </p>
            </div>

            <div style="margin-bottom: 30px">
              <h3 style="color: #1e3a8a; margin-bottom: 10px">
                Will watermark removal affect document quality?
              </h3>
              <p style="color: #555; line-height: 1.8">
                No. Watermark removal is a clean process that deletes only the
                selected watermark objects from the PDF structure. The
                underlying content, formatting, fonts, images, and layout remain
                unchanged. You'll get the same quality PDF without the
                watermarks.
              </p>
            </div>

            <div style="margin-bottom: 30px">
              <h3 style="color: #1e3a8a; margin-bottom: 10px">
                Can I remove watermarks from scanned PDFs?
              </h3>
              <p style="color: #555; line-height: 1.8">
                Scanned PDFs are images, not structured PDF objects. If the
                watermark is part of the scanned image, it won't be detected as
                a separate object. For scanned documents, you may need image
                editing tools or OCR conversion before watermark removal. Our
                tool works best with PDFs where watermarks were added digitally
                as text or image layers.
              </p>
            </div>

            <div style="margin-bottom: 30px">
              <h3 style="color: #1e3a8a; margin-bottom: 10px">
                What if I accidentally select the wrong watermark?
              </h3>
              <p style="color: #555; line-height: 1.8">
                Use the "Clear Selection" button to deselect all items and start
                over. Individual watermarks can be deselected by clicking them
                again. Your original file is never modifiedâ€”only the downloaded
                version reflects changes. You can always re-upload and try
                again.
              </p>
            </div>

            <div style="margin-bottom: 30px">
              <h3 style="color: #1e3a8a; margin-bottom: 10px">
                Can I remove watermarks from password-protected PDFs?
              </h3>
              <p style="color: #555; line-height: 1.8">
                Password-protected or encrypted PDFs must be unlocked first. Use
                our PDF unlock tool to remove security restrictions, then
                process watermarks. You'll need the password to unlock the PDF
                before watermark removal can proceed.
              </p>
            </div>

            <div style="margin-bottom: 30px">
              <h3 style="color: #1e3a8a; margin-bottom: 10px">
                How many watermarks can I remove at once?
              </h3>
              <p style="color: #555; line-height: 1.8">
                There's no limit. Select as many watermarks as needed across all
                pages and delete them in batch. This is particularly useful for
                documents with repeated watermarks on every pageâ€”select all
                instances and remove them simultaneously.
              </p>
            </div>

            <div style="margin-bottom: 30px">
              <h3 style="color: #1e3a8a; margin-bottom: 10px">
                Will the tool remove all watermarks automatically?
              </h3>
              <p style="color: #555; line-height: 1.8">
                No. The tool detects and highlights potential watermarks, but
                you manually select which ones to remove. This prevents
                accidental deletion of important content and gives you full
                control over what gets removed. This selective approach ensures
                precision and safety.
              </p>
            </div>

            <div style="margin-bottom: 30px">
              <h3 style="color: #1e3a8a; margin-bottom: 10px">
                Does watermark removal work on mobile devices?
              </h3>
              <p style="color: #555; line-height: 1.8">
                Yes. Our tool is fully responsive and works on smartphones and
                tablets. The interface adapts to smaller screens while
                maintaining full functionality. Upload, select, and download
                cleaned PDFs directly from your mobile device.
              </p>
            </div>

            <div style="margin-bottom: 30px">
              <h3 style="color: #1e3a8a; margin-bottom: 10px">
                What happens to my files after processing?
              </h3>
              <p style="color: #555; line-height: 1.8">
                All processing happens in your browser or on our secure servers
                with automatic deletion after download. We don't store, share,
                or keep your files. Your original file remains on your device
                and is never modified. Only the cleaned version you download
                contains the changes.
              </p>
            </div>

            <div style="margin-bottom: 30px">
              <h3 style="color: #1e3a8a; margin-bottom: 10px">
                Can I undo watermark removal after downloading?
              </h3>
              <p style="color: #555; line-height: 1.8">
                No. Watermark removal is permanent in the downloaded file.
                However, your original file with watermarks is never changed.
                Keep your original file if you think you might need the
                watermarked version later. You can always re-process the
                original if needed.
              </p>
            </div>
          </div>
        </div>
      </section>

      <!-- Related Tools Section -->
      <section class="benefits" style="background: white; padding-top: 60px">
        <div class="container">
          <h2>Related PDF Tools</h2>
          <div class="feature-grid">
            <div class="feature-card">
              <i
                class="fas fa-stamp"
                style="font-size: 40px; color: #4f46e5; margin-bottom: 15px"
                aria-hidden="true"
              ></i>
              <h3>Add Watermark</h3>
              <p>
                Add custom text or image watermarks to PDFs with full control
                over position, opacity, and rotation. Protect your documents.
              </p>
              <a
                href="/watermark"
                class="cta-button"
                style="font-size: 14px; padding: 8px 16px; margin-top: 10px"
                >Use Tool</a
              >
            </div>
            <div class="feature-card">
              <i
                class="fas fa-unlock"
                style="font-size: 40px; color: #4f46e5; margin-bottom: 15px"
                aria-hidden="true"
              ></i>
              <h3>Unlock PDF</h3>
              <p>
                Remove password protection and security restrictions from PDFs.
                Unlock documents before watermark removal.
              </p>
              <a
                href="/unlock-pdf"
                class="cta-button"
                style="font-size: 14px; padding: 8px 16px; margin-top: 10px"
                >Use Tool</a
              >
            </div>
            <div class="feature-card">
              <i
                class="fas fa-edit"
                style="font-size: 40px; color: #10b981; margin-bottom: 15px"
                aria-hidden="true"
              ></i>
              <h3>Edit PDF</h3>
              <p>
                Edit text, images, and content in PDFs. Make content changes
                before or after watermark removal.
              </p>
              <a
                href="/edit"
                class="cta-button"
                style="font-size: 14px; padding: 8px 16px; margin-top: 10px"
                >Use Tool</a
              >
            </div>
            <div class="feature-card">
              <i
                class="fas fa-object-group"
                style="font-size: 40px; color: #4f46e5; margin-bottom: 15px"
                aria-hidden="true"
              ></i>
              <h3>Merge PDF</h3>
              <p>
                Combine multiple cleaned PDFs into single documents. Merge files
                after watermark removal.
              </p>
              <a
                href="/merge"
                class="cta-button"
                style="font-size: 14px; padding: 8px 16px; margin-top: 10px"
                >Use Tool</a
              >
            </div>
            <div class="feature-card">
              <i
                class="fas fa-compress"
                style="font-size: 40px; color: #f59e0b; margin-bottom: 15px"
                aria-hidden="true"
              ></i>
              <h3>Compress PDF</h3>
              <p>
                Reduce file size of cleaned PDFs for easier sharing and storage.
                Optimize without quality loss.
              </p>
              <a
                href="/compress-pdf"
                class="cta-button"
                style="font-size: 14px; padding: 8px 16px; margin-top: 10px"
                >Use Tool</a
              >
            </div>
            <div class="feature-card">
              <i
                class="fas fa-file-pdf"
                style="font-size: 40px; color: #4f46e5; margin-bottom: 15px"
                aria-hidden="true"
              ></i>
              <h3>PDF to PDF/A</h3>
              <p>
                Convert cleaned PDFs to archival format for long-term storage
                and compliance.
              </p>
              <a
                href="/pdf-to-pdfa"
                class="cta-button"
                style="font-size: 14px; padding: 8px 16px; margin-top: 10px"
                >Use Tool</a
              >
            </div>
          </div>
        </div>
      </section>

      <!-- CTA Section -->
      <section class="hero">
        <div class="container">
          <h2 style="font-size: 32px; margin-bottom: 15px">
            Ready to Clean Your PDFs?
          </h2>
          <p style="margin-bottom: 25px">
            Remove unwanted watermarks from PDF files instantly. Click to
            select, delete, and download clean professional documents.
          </p>
          <a
            href="#"
            class="cta-button"
            onclick="
              window.scrollTo({ top: 0, behavior: 'smooth' });
              return false;
            "
            aria-label="Scroll to top to remove watermarks"
          >
            <i class="fa fa-eraser" aria-hidden="true"></i> Start Removing
            Watermarks
          </a>
        </div>
      </section>
    </main>

    <div
      class="loading-overlay"
      id="loadingOverlay"
      role="alert"
      aria-live="assertive"
    >
      <div class="loading-content">
        <div class="spinner"></div>
        <p>Processing PDF...</p>
      </div>
    </div>

    <section id="footer-placeholder"></section>

    <script src="./js/app.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
      // Use BACKEND_BASE_URL from app.js or fallback to localhost
      const DETECT_URL = `${BACKEND_BASE_URL}/detect-watermarks`;
      const REMOVE_URL = `${BACKEND_BASE_URL}/remove-watermark`;

      const pdfUpload = document.getElementById("pdfUpload");
      const uploadSection = document.getElementById("uploadSection");
      const fileList = document.getElementById("fileList");
      const pagesGrid = document.getElementById("pagesGrid");
      const controlPanel = document.getElementById("controlPanel");
      const selectionInfo = document.getElementById("selectionInfo");
      const clearBtn = document.getElementById("clearBtn");
      const deleteBtn = document.getElementById("deleteBtn");
      const removeBtn = document.getElementById("removeBtn");
      const errorMsg = document.getElementById("errorMsg");
      const successMsg = document.getElementById("successMsg");
      const loadingOverlay = document.getElementById("loadingOverlay");
      const resultBtns = document.getElementById("resultBtns");
      const downloadBtn = document.getElementById("downloadBtn");
      const shareBtn = document.getElementById("shareBtn");
      const resetBtn = document.getElementById("resetBtn");
      const noteBox = document.getElementById("noteBox");
      const pdfPreview = document.getElementById("pdfPreview");
      const pdfFrame = document.getElementById("pdfFrame");
      const fileNameLink = document.getElementById("fileNameLink");

      let currentFile = null;
      let detectedItems = [];
      let selectedItems = new Set();
      let pageRenderScales = {}; // Store the actual render scale for each page

      pdfjsLib.GlobalWorkerOptions.workerSrc =
        "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";

      function showError(msg) {
        errorMsg.textContent = msg;
        errorMsg.style.display = "inline-block";
        successMsg.classList.remove("show");
      }

      function clearError() {
        errorMsg.style.display = "none";
      }

      function showSuccess(msg) {
        successMsg.textContent = msg;
        successMsg.classList.add("show");
        clearError();
        setTimeout(() => successMsg.classList.remove("show"), 3000);
      }

      function showLoading() {
        loadingOverlay.classList.add("show");
      }

      function hideLoading() {
        loadingOverlay.classList.remove("show");
      }

      function updateSelectionInfo() {
        const selectedCount = selectedItems.size;
        if (selectedCount === 0) {
          selectionInfo.textContent = "No items selected";
        } else {
          selectionInfo.textContent = `${selectedCount} item${selectedCount > 1 ? "s" : ""} selected`;
        }
      }

      // Render file list (like merge.html)
      function renderFileList() {
        fileList.style.display = "block";
        fileList.innerHTML = "";

        const li = document.createElement("li");
        li.innerHTML = `<i class="fa fa-file-pdf pdf-icon" aria-hidden="true"></i> <span>${currentFile.name}</span> <button class="delete-file" id="deleteFileBtn" aria-label="Remove ${currentFile.name}"><i class="fa fa-times" aria-hidden="true"></i></button>`;
        fileList.appendChild(li);
      }

      // Handle file deletion
      fileList.addEventListener("click", (e) => {
        const deleteBtn = e.target.closest(".delete-file");
        if (deleteBtn) {
          resetApplication();
        }
      });

      // Proper reset function without page reload
      function resetApplication() {
        // Clear all data
        currentFile = null;
        detectedItems = [];
        selectedItems.clear();
        pageRenderScales = {};

        // Reset UI elements
        fileList.style.display = "none";
        fileList.innerHTML = "";
        uploadSection.style.display = "block";
        pagesGrid.style.display = "none";
        pagesGrid.innerHTML = "";
        controlPanel.style.display = "none";
        resultBtns.style.display = "none";
        pdfPreview.style.display = "none";
        noteBox.style.display = "block";

        // Reset file input
        pdfUpload.value = "";

        // Clear messages
        clearError();
        successMsg.classList.remove("show");

        // Reset iframe
        pdfFrame.src = "";

        // Reset download links
        if (downloadBtn.href && downloadBtn.href.startsWith("blob:")) {
          URL.revokeObjectURL(downloadBtn.href);
        }
        if (shareBtn.href && shareBtn.href.startsWith("blob:")) {
          URL.revokeObjectURL(shareBtn.href);
        }
        downloadBtn.href = "#";
        shareBtn.href = "#";

        // Scroll to top
        window.scrollTo({ top: 0, behavior: "smooth" });
      }

      // Upload PDF and detect watermarks
      pdfUpload.onchange = async (e) => {
        const file = e.target.files[0];
        if (!file) return;

        clearError();
        currentFile = file;
        selectedItems.clear();
        detectedItems = [];
        pageRenderScales = {};

        // Hide upload button and show file list
        uploadSection.style.display = "none";
        renderFileList();

        showLoading();

        try {
          // Detect watermarks from backend
          const formData = new FormData();
          formData.append("file", file);

          const detectRes = await fetch(DETECT_URL, {
            method: "POST",
            body: formData,
          });

          if (!detectRes.ok) {
            const errorData = await detectRes.json().catch(() => ({}));
            throw new Error(errorData.error || "Failed to detect watermarks");
          }

          const detectData = await detectRes.json();
          detectedItems = detectData.items || [];

          await renderPDFWithOverlays(file, detectedItems);

          hideLoading();
          showSuccess(
            `âœ“ Detected ${detectedItems.length} item${detectedItems.length !== 1 ? "s" : ""} (text and images)`,
          );
          controlPanel.style.display = "block";
          pagesGrid.style.display = "flex";
        } catch (error) {
          hideLoading();
          showError("Error: " + error.message);
          console.error("PDF Upload Error:", error);
          // Reset UI on error
          resetApplication();
        }
      };

      // Calculate display scale based on viewport - FIXED FOR ALL SCREEN SIZES
      function calculateDisplayScale(pdfPageWidth) {
        const container = pagesGrid.closest(".container");
        const containerWidth = container
          ? container.clientWidth
          : window.innerWidth;

        // Account for padding and margins
        let maxWidth;

        if (window.innerWidth < 480) {
          // Very small screens
          maxWidth = Math.min(containerWidth - 40, 320);
        } else if (window.innerWidth < 768) {
          // Mobile
          maxWidth = Math.min(containerWidth - 60, 480);
        } else if (window.innerWidth < 970) {
          // Medium screens (768-970px)
          maxWidth = Math.min(containerWidth - 80, 700);
        } else {
          // Desktop
          maxWidth = Math.min(containerWidth - 100, 800);
        }

        // Ensure we don't scale below a minimum width
        maxWidth = Math.max(maxWidth, 200);

        // Calculate scale to fit the PDF page width to display width
        return maxWidth / pdfPageWidth;
      }

      // Render PDF pages with overlays
      async function renderPDFWithOverlays(file, items) {
        pagesGrid.innerHTML = "";
        pageRenderScales = {};

        try {
          const fileURL = URL.createObjectURL(file);

          const loadingTask = pdfjsLib.getDocument({
            url: fileURL,
            cMapUrl: "https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/cmaps/",
            cMapPacked: true,
            verbosity: 0,
          });

          const pdf = await loadingTask.promise;

          // Group items by page
          const itemsByPage = {};
          items.forEach((item, idx) => {
            item.id = idx;
            const page = item.page;
            if (!itemsByPage[page]) itemsByPage[page] = [];
            itemsByPage[page].push(item);
          });

          // Render all pages sequentially
          for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
            try {
              const page = await pdf.getPage(pageNum);
              const viewport = page.getViewport({ scale: 1 });

              // Calculate display scale based on viewport width
              const displayScale = calculateDisplayScale(viewport.width);

              // Store the display scale for this page
              pageRenderScales[pageNum] = displayScale;

              // Use higher render scale for sharp rendering
              const renderScale = displayScale * (window.devicePixelRatio || 2);
              const scaledViewport = page.getViewport({ scale: renderScale });

              const canvas = document.createElement("canvas");
              const context = canvas.getContext("2d", {
                willReadFrequently: false,
                alpha: false,
              });

              canvas.width = scaledViewport.width;
              canvas.height = scaledViewport.height;

              const renderTask = page.render({
                canvasContext: context,
                viewport: scaledViewport,
                intent: "display",
                enableWebGL: false,
                renderInteractiveForms: false,
              });

              await renderTask.promise;

              // Apply CSS scaling to match display size
              const displayWidth = viewport.width * displayScale;
              const displayHeight = viewport.height * displayScale;

              canvas.style.width = displayWidth + "px";
              canvas.style.height = displayHeight + "px";

              const card = document.createElement("div");
              card.className = "page-card";
              card.dataset.pageNum = pageNum;
              card.setAttribute("role", "article");
              card.setAttribute("aria-label", `Page ${pageNum}`);

              const badge = document.createElement("div");
              badge.className = "page-number-badge";
              badge.textContent = `Page ${pageNum}`;
              badge.setAttribute("aria-hidden", "true");
              card.appendChild(badge);

              const container = document.createElement("div");
              container.className = "page-canvas-container";
              container.appendChild(canvas);

              // Add overlays with correct scale
              const pageItems = itemsByPage[pageNum] || [];
              pageItems.forEach((item) => {
                const overlay = createOverlay(item, displayScale, canvas);
                container.appendChild(overlay);
              });

              card.appendChild(container);
              pagesGrid.appendChild(card);

              page.cleanup();
            } catch (pageError) {
              console.error(`Error rendering page ${pageNum}:`, pageError);
            }
          }

          URL.revokeObjectURL(fileURL);
        } catch (error) {
          console.error("Error in renderPDFWithOverlays:", error);
          throw error;
        }
      }

      function createOverlay(item, displayScale, canvas) {
        const [x0, y0, x1, y1] = item.bbox;

        const overlay = document.createElement("div");
        overlay.className = `watermark-overlay type-${item.type}`;
        overlay.dataset.itemId = item.id;
        overlay.dataset.pageNum = item.page;
        overlay.setAttribute("role", "button");
        overlay.setAttribute("tabindex", "0");
        overlay.setAttribute(
          "aria-label",
          `${item.type === "text" ? "Text watermark: " + (item.text?.substring(0, 30) || "N/A") : "Image watermark"}. Click to select for removal.`,
        );

        // Use displayScale directly
        overlay.style.left = x0 * displayScale + "px";
        overlay.style.top = y0 * displayScale + "px";
        overlay.style.width = (x1 - x0) * displayScale + "px";
        overlay.style.height = (y1 - y0) * displayScale + "px";

        // Label
        const label = document.createElement("div");
        label.className = "overlay-label";
        label.textContent =
          item.type === "text"
            ? `Text: ${item.text?.substring(0, 30) || "N/A"}`
            : "Image";
        label.setAttribute("aria-hidden", "true");
        overlay.appendChild(label);

        // Delete icon
        const deleteIcon = document.createElement("div");
        deleteIcon.className = "delete-icon";
        deleteIcon.innerHTML = '<i class="fa fa-times" aria-hidden="true"></i>';
        deleteIcon.setAttribute("role", "button");
        deleteIcon.setAttribute("aria-label", "Delete this watermark");
        deleteIcon.setAttribute("tabindex", "0");
        overlay.appendChild(deleteIcon);

        overlay.onclick = (e) => {
          if (e.target.closest(".delete-icon")) return;
          toggleSelection(item.id, overlay);
        };

        overlay.onkeydown = (e) => {
          if (e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            if (!e.target.closest(".delete-icon")) {
              toggleSelection(item.id, overlay);
            }
          }
        };

        deleteIcon.onclick = (e) => {
          e.stopPropagation();
          deleteWatermark(item.id, overlay);
        };

        deleteIcon.onkeydown = (e) => {
          if (e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            e.stopPropagation();
            deleteWatermark(item.id, overlay);
          }
        };

        return overlay;
      }

      function toggleSelection(itemId, overlay) {
        if (selectedItems.has(itemId)) {
          selectedItems.delete(itemId);
          overlay.classList.remove("selected");
          overlay.setAttribute("aria-pressed", "false");
        } else {
          selectedItems.add(itemId);
          overlay.classList.add("selected");
          overlay.setAttribute("aria-pressed", "true");
          clearError();
        }
        updateSelectionInfo();
      }

      // Delete single watermark immediately and update preview
      async function deleteWatermark(itemId, overlay) {
        const item = detectedItems.find((i) => i.id === itemId);
        if (!item) return;

        showLoading();
        clearError();

        try {
          const formData = new FormData();
          formData.append("files", currentFile);
          formData.append("watermarks", JSON.stringify([item]));

          const res = await fetch(REMOVE_URL, {
            method: "POST",
            body: formData,
          });
          if (!res.ok) {
            const errorData = await res.json().catch(() => ({}));
            throw new Error(errorData.error || "Failed to remove watermark");
          }

          const blob = await res.blob();
          currentFile = new File([blob], currentFile.name, {
            type: "application/pdf",
          });

          const deletedPageNum = item.page;

          detectedItems = detectedItems.filter((i) => i.id !== itemId);
          selectedItems.delete(itemId);

          detectedItems.forEach((item, idx) => {
            item.id = idx;
          });

          await reRenderSinglePage(deletedPageNum, currentFile, detectedItems);

          updateSelectionInfo();
          hideLoading();

          showSuccess("âœ“ Watermark removed successfully");
        } catch (error) {
          hideLoading();
          showError("Error: " + error.message);
        }
      }

      // Re-render only a single page
      async function reRenderSinglePage(pageNumber, file, items) {
        try {
          const fileURL = URL.createObjectURL(file);

          const loadingTask = pdfjsLib.getDocument({
            url: fileURL,
            cMapUrl: "https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/cmaps/",
            cMapPacked: true,
            verbosity: 0,
          });

          const pdf = await loadingTask.promise;
          const pageItems = items.filter((item) => item.page === pageNumber);

          const page = await pdf.getPage(pageNumber);
          const viewport = page.getViewport({ scale: 1 });

          // Calculate display scale
          const displayScale = calculateDisplayScale(viewport.width);

          // Update stored scale
          pageRenderScales[pageNumber] = displayScale;

          // Use higher render scale for sharp text
          const renderScale = displayScale * (window.devicePixelRatio || 2);
          const scaledViewport = page.getViewport({ scale: renderScale });

          const canvas = document.createElement("canvas");
          const context = canvas.getContext("2d", {
            willReadFrequently: false,
            alpha: false,
          });

          canvas.width = scaledViewport.width;
          canvas.height = scaledViewport.height;

          const renderTask = page.render({
            canvasContext: context,
            viewport: scaledViewport,
            intent: "display",
            enableWebGL: false,
            renderInteractiveForms: false,
          });

          await renderTask.promise;

          // Apply CSS scaling
          const displayWidth = viewport.width * displayScale;
          const displayHeight = viewport.height * displayScale;

          canvas.style.width = displayWidth + "px";
          canvas.style.height = displayHeight + "px";

          const pageCards = pagesGrid.querySelectorAll(".page-card");
          const targetCard = pageCards[pageNumber - 1];

          if (targetCard) {
            const badge = document.createElement("div");
            badge.className = "page-number-badge";
            badge.textContent = `Page ${pageNumber}`;
            badge.setAttribute("aria-hidden", "true");

            const container = document.createElement("div");
            container.className = "page-canvas-container";
            container.appendChild(canvas);

            pageItems.forEach((item) => {
              const overlay = createOverlay(item, displayScale, canvas);
              container.appendChild(overlay);
            });

            targetCard.innerHTML = "";
            targetCard.appendChild(badge);
            targetCard.appendChild(container);
          }

          page.cleanup();
          URL.revokeObjectURL(fileURL);
        } catch (error) {
          console.error(`Error re-rendering page ${pageNumber}:`, error);
          throw error;
        }
      }

      // Clear selection
      clearBtn.onclick = () => {
        const selectedOverlays = document.querySelectorAll(
          ".watermark-overlay.selected",
        );

        if (selectedOverlays.length === 0) {
          showError("You haven't selected any items to clear");
          return;
        }

        selectedItems.clear();

        selectedOverlays.forEach((el) => {
          el.classList.remove("selected");
          el.setAttribute("aria-pressed", "false");
        });

        updateSelectionInfo();
        clearError();
      };

      // Delete selected items in batch
      deleteBtn.onclick = async () => {
        if (selectedItems.size === 0) {
          showError("Please select items to delete first!");
          return;
        }

        showLoading();
        clearError();

        try {
          const itemsToRemove = Array.from(selectedItems)
            .map((id) => detectedItems.find((i) => i.id === id))
            .filter(Boolean);

          const affectedPages = [
            ...new Set(itemsToRemove.map((item) => item.page)),
          ];

          const formData = new FormData();
          formData.append("files", currentFile);
          formData.append("watermarks", JSON.stringify(itemsToRemove));

          const res = await fetch(REMOVE_URL, {
            method: "POST",
            body: formData,
          });
          if (!res.ok) {
            const errorData = await res.json().catch(() => ({}));
            throw new Error(
              errorData.error || "Failed to delete selected watermarks",
            );
          }

          const blob = await res.blob();
          currentFile = new File([blob], currentFile.name, {
            type: "application/pdf",
          });

          detectedItems = detectedItems.filter((i) => !selectedItems.has(i.id));

          detectedItems.forEach((item, idx) => {
            item.id = idx;
          });

          for (const pageNum of affectedPages) {
            await reRenderSinglePage(pageNum, currentFile, detectedItems);
          }

          selectedItems.clear();
          updateSelectionInfo();
          hideLoading();

          showSuccess(
            `âœ“ Deleted ${itemsToRemove.length} watermark${itemsToRemove.length !== 1 ? "s" : ""}`,
          );
        } catch (error) {
          hideLoading();
          showError("Error: " + error.message);
        }
      };

      // Save Changes button
      removeBtn.onclick = () => {
        const url = URL.createObjectURL(currentFile);
        downloadBtn.href = url;
        downloadBtn.download = "cleaned.pdf";
        shareBtn.href = url;

        uploadSection.style.display = "none";
        fileList.style.display = "none";
        pagesGrid.style.display = "none";
        controlPanel.style.display = "none";
        noteBox.style.display = "none";

        resultBtns.style.display = "block";

        const isSmallDevice = window.matchMedia("(max-width: 768px)").matches;

        if (!isSmallDevice) {
          pdfFrame.src = url;
          pdfPreview.style.display = "block";
        }

        fileNameLink.onclick = (e) => {
          e.preventDefault();
          if (isSmallDevice) {
            window.open(url, "_blank");
          } else {
            pdfPreview.scrollIntoView({ behavior: "smooth" });
          }
        };
      };

      // Reset page
      resetBtn.onclick = () => {
        resetApplication();
      };

      // Handle window resize to maintain proper overlay positioning
      let resizeTimeout;
      window.addEventListener("resize", () => {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(async () => {
          if (currentFile && detectedItems.length > 0) {
            // Re-render all pages with new scale
            await renderPDFWithOverlays(currentFile, detectedItems);
            updateSelectionInfo();
          }
        }, 300);
      });
    </script>
  </body>
</html>
